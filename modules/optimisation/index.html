
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../policy_changes/">
      
      
        <link rel="next" href="../../historic_tax_search_plan/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Policy Optimisation - NZ Tax Microsimulation Model</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#policy-optimisation-parameter-scanning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NZ Tax Microsimulation Model" class="md-header__button md-logo" aria-label="NZ Tax Microsimulation Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NZ Tax Microsimulation Model
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Policy Optimisation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/edithatogo/nztaxmicrosim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    edithatogo/nztaxmicrosim
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NZ Tax Microsimulation Model" class="md-nav__button md-logo" aria-label="NZ Tax Microsimulation Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NZ Tax Microsimulation Model
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/edithatogo/nztaxmicrosim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    edithatogo/nztaxmicrosim
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CITATION.cff" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citing this work
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LICENSE" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Project Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roadmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development_log/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Log
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Model Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Model Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parameter_coverage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameter Coverage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../inflation_adjustment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inflation Adjustment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../demographic_modelling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Demographic Modelling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../historical_reporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Historical Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../behavioural/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Behavioural Response
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data_dictionary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Dictionary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../feature_matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policy_changes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Changes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Policy Optimisation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Policy Optimisation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      How to Use
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to Use">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-script" class="md-nav__link">
    <span class="md-ellipsis">
      Example Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-the-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      1. The Configuration File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-defining-metric-functions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Defining Metric Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#function-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Function Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phase-2-advanced-policy-optimisation-with-optuna" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: Advanced Policy Optimisation with Optuna
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 2: Advanced Policy Optimisation with Optuna">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How it Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use_1" class="md-nav__link">
    <span class="md-ellipsis">
      How to Use
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-the-optimisation-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      1. The Optimisation Configuration File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-interpreting-the-results" class="md-nav__link">
    <span class="md-ellipsis">
      2. Interpreting the Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../historic_tax_search_plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Historic Tax Search Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nz_microsim_paper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NZ Microsim Paper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../personal_tax_history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Personal Tax History
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../personal_tax_history_1970-25_narrative/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Personal Tax History 1970-25 Narrative
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../personal_tax_history_1970-25_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Personal Tax History 1970-25 Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reporting_plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reporting Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taxmicrosim_io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tax Microsim I/O
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../taxmicrosim_report_components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tax Microsim Report Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../validation_report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation Report
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wff_microsim_model_metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WFF Microsim Model Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../feature_comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../module_status/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module Status
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      How to Use
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to Use">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-script" class="md-nav__link">
    <span class="md-ellipsis">
      Example Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-the-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      1. The Configuration File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-defining-metric-functions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Defining Metric Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#function-reference" class="md-nav__link">
    <span class="md-ellipsis">
      Function Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phase-2-advanced-policy-optimisation-with-optuna" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: Advanced Policy Optimisation with Optuna
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 2: Advanced Policy Optimisation with Optuna">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      How it Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use_1" class="md-nav__link">
    <span class="md-ellipsis">
      How to Use
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-the-optimisation-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      1. The Optimisation Configuration File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-interpreting-the-results" class="md-nav__link">
    <span class="md-ellipsis">
      2. Interpreting the Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="policy-optimisation-parameter-scanning">Policy Optimisation: Parameter Scanning</h1>
<p>This document describes the Parameter Scanning tool, which is the first phase of the Policy Optimisation module. This tool allows researchers and policy analysts to efficiently run the microsimulation model across multiple variations of policy parameters and evaluate the results.</p>
<h2 id="overview">Overview</h2>
<p>The core of the tool is the <code>run_parameter_scan</code> function located in <code>src.optimisation</code>. It is designed to answer questions like:
- "What would be the effect on total tax revenue if we changed the top tax rate?"
- "How does increasing a tax credit affect government expenditure compared to the baseline policy?"</p>
<p>It works by taking a baseline population and a set of policy "scenarios". For each scenario, it adjusts the policy parameters, runs a simulation, and calculates a set of key metrics defined by the user.</p>
<h2 id="how-to-use">How to Use</h2>
<p>Using the tool involves three main steps:
1.  <strong>Prepare a population dataset:</strong> This is a standard pandas DataFrame, the same kind used for single simulation runs.
2.  <strong>Create a YAML configuration file:</strong> This file defines the different policy scenarios you want to test.
3.  <strong>Define metric functions:</strong> These are Python functions that calculate the specific outcomes you are interested in (e.g., revenue, inequality).</p>
<h3 id="example-script">Example Script</h3>
<p>An example script is provided in <code>examples/run_parameter_scan.py</code>. It demonstrates the full workflow. To run it, you can execute:</p>
<pre><code class="language-bash">python examples/run_parameter_scan.py
</code></pre>
<h3 id="1-the-configuration-file">1. The Configuration File</h3>
<p>The scenarios are defined in a YAML file. The file must have a top-level key called <code>scenarios</code>, which contains a list of individual scenario configurations.</p>
<p>Each scenario needs:
- <code>id</code>: A unique string to identify the scenario in the results.
- <code>description</code>: A brief explanation of what the scenario does.
- <code>parameters</code>: A dictionary where keys are the parameters to change, and values are the new values.</p>
<p>Parameter keys are <strong>dot-separated paths</strong> that correspond to the structure of the <code>Parameters</code> model in <code>src.parameters</code>.</p>
<p><strong>Example: <code>examples/scan_config.yaml</code></strong></p>
<pre><code class="language-yaml">scenarios:
  - id: &quot;baseline&quot;
    description: &quot;The current policy settings for 2024-2025.&quot;
    parameters:
      # No overrides, use the default parameters for the base year.
      {}

  - id: &quot;higher_top_tax_rate&quot;
    description: &quot;Increase the top tax rate from 39% to 42%.&quot;
    parameters:
      tax_brackets.rates: [0.105, 0.175, 0.30, 0.33, 0.42]

  - id: &quot;increase_ietc&quot;
    description: &quot;Increase the Independent Earner Tax Credit entitlement by 20%.&quot;
    parameters:
      ietc.ent: 624 # Original is 520
</code></pre>
<h3 id="2-defining-metric-functions">2. Defining Metric Functions</h3>
<p>You can measure any outcome from a simulation by defining a "metric function". This is a Python function that accepts a pandas DataFrame (the output of a simulation) and returns a single number.</p>
<p><strong>Example from the script:</strong></p>
<pre><code class="language-python">def total_tax_revenue(df: pd.DataFrame) -&gt; float:
    &quot;&quot;&quot;Calculates the total income tax paid by the population.&quot;&quot;&quot;
    return df[&quot;tax_liability&quot;].sum()

def total_wff_paid(df: pd.DataFrame) -&gt; float:
    &quot;&quot;&quot;Calculates the total Working for Families credits paid.&quot;&quot;&quot;
    wff_columns = [&quot;FTCcalc&quot;, &quot;IWTCcalc&quot;, &quot;BSTCcalc&quot;, &quot;MFTCcalc&quot;]
    existing_cols = [col for col in wff_columns if col in df.columns]
    return df[existing_cols].sum().sum()

# These are then passed to the scanner in a dictionary:
metrics_to_run = {
    &quot;Total Tax Revenue&quot;: total_tax_revenue,
    &quot;Total WFF Paid&quot;: total_wff_paid
}
</code></pre>
<h2 id="function-reference">Function Reference</h2>
<p><code>run_parameter_scan(base_df, base_year, scan_config, metrics)</code></p>
<ul>
<li><strong><code>base_df</code></strong>: The initial population DataFrame.</li>
<li><strong><code>base_year</code></strong>: The base year for the simulation (e.g., "2024-2025"). The tool will load the default parameters for this year before applying any scenario overrides.</li>
<li><strong><code>scan_config</code></strong>: A dictionary loaded from your YAML configuration file.</li>
<li><strong><code>metrics</code></strong>: A dictionary mapping metric names (strings) to your metric functions.</li>
</ul>
<p>The function returns a pandas DataFrame where each row contains the results for one scenario, making it easy to compare the impacts of different policy choices.</p>
<hr />
<h2 id="phase-2-advanced-policy-optimisation-with-optuna">Phase 2: Advanced Policy Optimisation with Optuna</h2>
<p>Building on the parameter scanning tool, the advanced policy optimisation feature uses the <code>Optuna</code> library to intelligently search for optimal policy parameters. Instead of testing a pre-defined grid of scenarios, this tool explores a continuous search space to find parameter combinations that maximize or minimize a specific objective function.</p>
<h3 id="how-it-works">How it Works</h3>
<p>The core of this feature is the <code>run_policy_optimisation</code> function. It wraps the simulation logic in an "objective function" that Optuna repeatedly calls with different parameter values. Optuna's samplers use the history of previous results to guide the search towards more promising areas of the parameter space.</p>
<h3 id="how-to-use_1">How to Use</h3>
<p>The workflow is similar to the parameter scanner, but the configuration file is different.</p>
<p><strong>Example Script:</strong>
An example is provided in <code>examples/run_policy_optimisation.py</code>.</p>
<pre><code class="language-bash">python examples/run_policy_optimisation.py
</code></pre>
<h3 id="1-the-optimisation-configuration-file">1. The Optimisation Configuration File</h3>
<p>The study is defined in a YAML file. It has three main sections: <code>objective</code>, <code>n_trials</code>, and <code>search_space</code>.</p>
<ul>
<li><strong><code>objective</code></strong>: Defines the goal of the study.</li>
<li><code>name</code>: The metric to be optimized. This must correspond to a key in the <code>metrics</code> dictionary you provide.</li>
<li><code>direction</code>: Can be <code>"maximize"</code> or <code>"minimize"</code>.</li>
<li><strong><code>n_trials</code></strong>: The total number of simulations the optimiser will run.</li>
<li><strong><code>search_space</code></strong>: A list of parameters to vary. Each entry defines:</li>
<li><code>name</code>: A unique name for the parameter in the study.</li>
<li><code>path</code>: The dot-separated path to the parameter in the <code>Parameters</code> model.</li>
<li><code>type</code>: The type of value to search for (<code>float</code>, <code>int</code>, or <code>categorical</code>).</li>
<li>The range of values (<code>low</code> and <code>high</code> for <code>float</code>/<code>int</code>, or <code>choices</code> for <code>categorical</code>).</li>
</ul>
<p><strong>Example: <code>examples/opt_config.yaml</code></strong></p>
<pre><code class="language-yaml">objective:
  name: &quot;total_tax_revenue&quot;
  direction: &quot;maximize&quot;

n_trials: 50

search_space:
  - name: &quot;top_tax_rate&quot;
    path: &quot;tax_brackets.rates.4&quot;
    type: &quot;float&quot;
    low: 0.38
    high: 0.45
  - name: &quot;ietc_entitlement&quot;
    path: &quot;ietc.ent&quot;
    type: &quot;int&quot;
    low: 520
    high: 700
</code></pre>
<h3 id="2-interpreting-the-results">2. Interpreting the Results</h3>
<p>The <code>run_policy_optimisation</code> function returns a completed Optuna <code>study</code> object. This object contains a wealth of information about the optimisation process. The example script shows how to access the most important results:</p>
<ul>
<li><code>study.best_trial</code>: The trial that resulted in the best objective value.</li>
<li><code>study.best_params</code>: A dictionary of the parameter values that yielded the best result.</li>
<li><code>study.best_value</code>: The best objective score achieved.</li>
</ul>
<p>You can also access the <code>user_attrs</code> of the best trial to see the values of all other metrics for that trial, which is useful for understanding trade-offs.</p>
<p>For more advanced analysis, Optuna provides powerful visualization tools (e.g., <code>optuna.visualization.plot_optimization_history</code>) that can be used with the returned <code>study</code> object.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>