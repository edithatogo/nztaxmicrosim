
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../module_status/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>API Reference - NZ Tax Microsimulation Model</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NZ Tax Microsimulation Model" class="md-header__button md-logo" aria-label="NZ Tax Microsimulation Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NZ Tax Microsimulation Model
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/edithatogo/nztaxmicrosim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    edithatogo/nztaxmicrosim
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NZ Tax Microsimulation Model" class="md-nav__button md-logo" aria-label="NZ Tax Microsimulation Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NZ Tax Microsimulation Model
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/edithatogo/nztaxmicrosim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    edithatogo/nztaxmicrosim
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CITATION.cff" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citing this work
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LICENSE" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Project Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roadmap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development_log/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Log
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Model Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Model Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parameter_coverage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameter Coverage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inflation_adjustment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inflation Adjustment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../demographic_modelling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Demographic Modelling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../historical_reporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Historical Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/behavioural/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Behavioural Response
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_dictionary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Dictionary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feature_matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy_changes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Changes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/optimisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policy Optimisation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../historic_tax_search_plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Historic Tax Search Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nz_microsim_paper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NZ Microsim Paper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../personal_tax_history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Personal Tax History
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../personal_tax_history_1970-25_narrative/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Personal Tax History 1970-25 Narrative
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../personal_tax_history_1970-25_table/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Personal Tax History 1970-25 Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reporting_plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reporting Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../taxmicrosim_io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tax Microsim I/O
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../taxmicrosim_report_components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tax Microsim Report Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation_report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation Report
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wff_microsim_model_metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WFF Microsim Model Metadata
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../external/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feature_comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../module_status/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module Status
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Core Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation Pipeline
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline" class="md-nav__link">
    <span class="md-ellipsis">
      SimulationPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimulationPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.disable" class="md-nav__link">
    <span class="md-ellipsis">
      disable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.enable" class="md-nav__link">
    <span class="md-ellipsis">
      enable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.replace" class="md-nav__link">
    <span class="md-ellipsis">
      replace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-simulation-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Main Simulation Logic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.microsim" class="md-nav__link">
    <span class="md-ellipsis">
      microsim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="microsim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.microsim.calctax" class="md-nav__link">
    <span class="md-ellipsis">
      calctax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.calculate_net_weekly_income" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_net_weekly_income
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.load_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      load_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.simrwt" class="md-nav__link">
    <span class="md-ellipsis">
      simrwt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.supstd" class="md-nav__link">
    <span class="md-ellipsis">
      supstd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.taxit" class="md-nav__link">
    <span class="md-ellipsis">
      taxit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tax-levy-calculations" class="md-nav__link">
    <span class="md-ellipsis">
      Tax &amp; Levy Calculations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tax &amp; Levy Calculations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-tax-calculator" class="md-nav__link">
    <span class="md-ellipsis">
      Main Tax Calculator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.tax_calculator" class="md-nav__link">
    <span class="md-ellipsis">
      tax_calculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tax_calculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      TaxCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TaxCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.calculate_emtr" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_emtr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.donation_credit" class="md-nav__link">
    <span class="md-ellipsis">
      donation_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.eitc" class="md-nav__link">
    <span class="md-ellipsis">
      eitc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.family_boost_credit" class="md-nav__link">
    <span class="md-ellipsis">
      family_boost_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.from_year" class="md-nav__link">
    <span class="md-ellipsis">
      from_year
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.ietc" class="md-nav__link">
    <span class="md-ellipsis">
      ietc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.income_tax" class="md-nav__link">
    <span class="md-ellipsis">
      income_tax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.pie_tax" class="md-nav__link">
    <span class="md-ellipsis">
      pie_tax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.rwt" class="md-nav__link">
    <span class="md-ellipsis">
      rwt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tax-credits" class="md-nav__link">
    <span class="md-ellipsis">
      Tax Credits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.tax_credits" class="md-nav__link">
    <span class="md-ellipsis">
      tax_credits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tax_credits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.calcietc" class="md-nav__link">
    <span class="md-ellipsis">
      calcietc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.calculate_donation_credit" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_donation_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.eitc" class="md-nav__link">
    <span class="md-ellipsis">
      eitc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.family_boost_credit" class="md-nav__link">
    <span class="md-ellipsis">
      family_boost_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acc-levy" class="md-nav__link">
    <span class="md-ellipsis">
      ACC Levy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.acc_levy" class="md-nav__link">
    <span class="md-ellipsis">
      acc_levy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="acc_levy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.acc_levy.calculate_acc_levy" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_acc_levy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.acc_levy.calculate_payroll_deductions" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_payroll_deductions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#investment-income-tax-pie" class="md-nav__link">
    <span class="md-ellipsis">
      Investment Income Tax (PIE)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.investment_tax" class="md-nav__link">
    <span class="md-ellipsis">
      investment_tax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="investment_tax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.investment_tax.calculate_pie_tax" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_pie_tax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payroll-deductions-kiwisaver-student-loans" class="md-nav__link">
    <span class="md-ellipsis">
      Payroll Deductions (KiwiSaver, Student Loans)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.payroll_deductions" class="md-nav__link">
    <span class="md-ellipsis">
      payroll_deductions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="payroll_deductions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.payroll_deductions.calculate_kiwisaver_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_kiwisaver_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.payroll_deductions.calculate_student_loan_repayment" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_student_loan_repayment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefit-calculations" class="md-nav__link">
    <span class="md-ellipsis">
      Benefit Calculations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefit Calculations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benefit-rule-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Benefit Rule Classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.benefit_rules" class="md-nav__link">
    <span class="md-ellipsis">
      benefit_rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="benefit_rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.AccommodationSupplementRule" class="md-nav__link">
    <span class="md-ellipsis">
      AccommodationSupplementRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AccommodationSupplementRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.AccommodationSupplementRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.BSTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      BSTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BSTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.BSTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.DisabilityAllowanceRule" class="md-nav__link">
    <span class="md-ellipsis">
      DisabilityAllowanceRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DisabilityAllowanceRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.DisabilityAllowanceRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.FTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      FTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.FTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.IWTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      IWTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IWTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.IWTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.JSSRule" class="md-nav__link">
    <span class="md-ellipsis">
      JSSRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSSRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.JSSRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.MFTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      MFTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MFTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.MFTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SLPRule" class="md-nav__link">
    <span class="md-ellipsis">
      SLPRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SLPRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SLPRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SPSRule" class="md-nav__link">
    <span class="md-ellipsis">
      SPSRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SPSRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SPSRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.WEPRule" class="md-nav__link">
    <span class="md-ellipsis">
      WEPRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WEPRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.WEPRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefit-calculation-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Benefit Calculation Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.benefits" class="md-nav__link">
    <span class="md-ellipsis">
      benefits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_accommodation_supplement" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_accommodation_supplement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_bstc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bstc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_child_support" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_child_support
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_disability_allowance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_disability_allowance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_ftc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_ftc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_iwtc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_iwtc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_jss" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_jss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_mftc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_mftc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_ppl" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_ppl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_slp" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_slp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_sps" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_sps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_wep" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_wep
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Core Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation Pipeline
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline" class="md-nav__link">
    <span class="md-ellipsis">
      SimulationPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimulationPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.disable" class="md-nav__link">
    <span class="md-ellipsis">
      disable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.enable" class="md-nav__link">
    <span class="md-ellipsis">
      enable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.replace" class="md-nav__link">
    <span class="md-ellipsis">
      replace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.pipeline.SimulationPipeline.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-simulation-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Main Simulation Logic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.microsim" class="md-nav__link">
    <span class="md-ellipsis">
      microsim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="microsim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.microsim.calctax" class="md-nav__link">
    <span class="md-ellipsis">
      calctax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.calculate_net_weekly_income" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_net_weekly_income
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.load_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      load_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.simrwt" class="md-nav__link">
    <span class="md-ellipsis">
      simrwt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.supstd" class="md-nav__link">
    <span class="md-ellipsis">
      supstd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.microsim.taxit" class="md-nav__link">
    <span class="md-ellipsis">
      taxit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tax-levy-calculations" class="md-nav__link">
    <span class="md-ellipsis">
      Tax &amp; Levy Calculations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tax &amp; Levy Calculations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-tax-calculator" class="md-nav__link">
    <span class="md-ellipsis">
      Main Tax Calculator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.tax_calculator" class="md-nav__link">
    <span class="md-ellipsis">
      tax_calculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tax_calculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator" class="md-nav__link">
    <span class="md-ellipsis">
      TaxCalculator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TaxCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.calculate_emtr" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_emtr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.donation_credit" class="md-nav__link">
    <span class="md-ellipsis">
      donation_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.eitc" class="md-nav__link">
    <span class="md-ellipsis">
      eitc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.family_boost_credit" class="md-nav__link">
    <span class="md-ellipsis">
      family_boost_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.from_year" class="md-nav__link">
    <span class="md-ellipsis">
      from_year
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.ietc" class="md-nav__link">
    <span class="md-ellipsis">
      ietc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.income_tax" class="md-nav__link">
    <span class="md-ellipsis">
      income_tax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.pie_tax" class="md-nav__link">
    <span class="md-ellipsis">
      pie_tax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_calculator.TaxCalculator.rwt" class="md-nav__link">
    <span class="md-ellipsis">
      rwt
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tax-credits" class="md-nav__link">
    <span class="md-ellipsis">
      Tax Credits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.tax_credits" class="md-nav__link">
    <span class="md-ellipsis">
      tax_credits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tax_credits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.calcietc" class="md-nav__link">
    <span class="md-ellipsis">
      calcietc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.calculate_donation_credit" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_donation_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.eitc" class="md-nav__link">
    <span class="md-ellipsis">
      eitc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tax_credits.family_boost_credit" class="md-nav__link">
    <span class="md-ellipsis">
      family_boost_credit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acc-levy" class="md-nav__link">
    <span class="md-ellipsis">
      ACC Levy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.acc_levy" class="md-nav__link">
    <span class="md-ellipsis">
      acc_levy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="acc_levy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.acc_levy.calculate_acc_levy" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_acc_levy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.acc_levy.calculate_payroll_deductions" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_payroll_deductions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#investment-income-tax-pie" class="md-nav__link">
    <span class="md-ellipsis">
      Investment Income Tax (PIE)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.investment_tax" class="md-nav__link">
    <span class="md-ellipsis">
      investment_tax
    </span>
  </a>
  
    <nav class="md-nav" aria-label="investment_tax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.investment_tax.calculate_pie_tax" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_pie_tax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payroll-deductions-kiwisaver-student-loans" class="md-nav__link">
    <span class="md-ellipsis">
      Payroll Deductions (KiwiSaver, Student Loans)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.payroll_deductions" class="md-nav__link">
    <span class="md-ellipsis">
      payroll_deductions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="payroll_deductions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.payroll_deductions.calculate_kiwisaver_contribution" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_kiwisaver_contribution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.payroll_deductions.calculate_student_loan_repayment" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_student_loan_repayment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefit-calculations" class="md-nav__link">
    <span class="md-ellipsis">
      Benefit Calculations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefit Calculations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benefit-rule-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Benefit Rule Classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.benefit_rules" class="md-nav__link">
    <span class="md-ellipsis">
      benefit_rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="benefit_rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.AccommodationSupplementRule" class="md-nav__link">
    <span class="md-ellipsis">
      AccommodationSupplementRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AccommodationSupplementRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.AccommodationSupplementRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.BSTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      BSTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BSTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.BSTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.DisabilityAllowanceRule" class="md-nav__link">
    <span class="md-ellipsis">
      DisabilityAllowanceRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DisabilityAllowanceRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.DisabilityAllowanceRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.FTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      FTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.FTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.IWTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      IWTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IWTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.IWTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.JSSRule" class="md-nav__link">
    <span class="md-ellipsis">
      JSSRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSSRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.JSSRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.MFTCRule" class="md-nav__link">
    <span class="md-ellipsis">
      MFTCRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MFTCRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.MFTCRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SLPRule" class="md-nav__link">
    <span class="md-ellipsis">
      SLPRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SLPRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SLPRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SPSRule" class="md-nav__link">
    <span class="md-ellipsis">
      SPSRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SPSRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.SPSRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.WEPRule" class="md-nav__link">
    <span class="md-ellipsis">
      WEPRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WEPRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefit_rules.WEPRule.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefit-calculation-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Benefit Calculation Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.benefits" class="md-nav__link">
    <span class="md-ellipsis">
      benefits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_accommodation_supplement" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_accommodation_supplement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_bstc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_bstc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_child_support" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_child_support
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_disability_allowance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_disability_allowance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_ftc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_ftc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_iwtc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_iwtc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_jss" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_jss
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_mftc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_mftc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_ppl" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_ppl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_slp" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_slp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_sps" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_sps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.benefits.calculate_wep" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_wep
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference">API Reference</h1>
<p>This section provides a complete API reference for the <code>nztaxmicrosim</code> package, automatically generated from the source code docstrings.</p>
<h2 id="core-simulation">Core Simulation</h2>
<h3 id="simulation-pipeline">Simulation Pipeline</h3>


<div class="doc doc-object doc-module">



<h2 id="src.pipeline" class="doc doc-heading">
            <code>src.pipeline</code>


</h2>

    <div class="doc doc-contents first">

        <p>Simple plug-in pipeline for orchestrating tax and benefit rules.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.pipeline.SimulationPipeline" class="doc doc-heading">
            <code>SimulationPipeline</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">


        <p>A pipeline for running a series of simulation rules.</p>
<p>The pipeline stores a list of rules and executes them sequentially on a
given data dictionary. Rules can be enabled, disabled, or replaced.</p>







              <details class="quote">
                <summary>Source code in <code>src/pipeline.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SimulationPipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pipeline for running a series of simulation rules.</span>

<span class="sd">    The pipeline stores a list of rules and executes them sequentially on a</span>
<span class="sd">    given data dictionary. Rules can be enabled, disabled, or replaced.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SimulationPipeline&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a SimulationPipeline from a YAML configuration file.</span>

<span class="sd">        The configuration file should specify a list of rules to be included</span>
<span class="sd">        in the pipeline. This method uses the RULE_REGISTRY to find and</span>
<span class="sd">        instantiate the rules. The rules are instantiated without parameters;</span>
<span class="sd">        they are expected to receive them from the `data` dictionary during</span>
<span class="sd">        the `run` phase.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_path: The path to the YAML configuration file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new `SimulationPipeline` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Import all rule modules to ensure they are registered</span>

        <span class="k">for</span> <span class="n">rule_config</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;rules&quot;</span><span class="p">]:</span>
            <span class="n">rule_name</span> <span class="o">=</span> <span class="n">rule_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rule_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rule_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RULE_REGISTRY</span><span class="p">:</span>
                <span class="c1"># Fallback for old format</span>
                <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">rule_name</span><span class="p">:</span>
                    <span class="n">module_path</span><span class="p">,</span> <span class="n">class_name</span> <span class="o">=</span> <span class="n">rule_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_path</span><span class="p">)</span>
                        <span class="n">rule_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown rule: </span><span class="si">{</span><span class="n">rule_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown rule: </span><span class="si">{</span><span class="n">rule_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rule_class</span> <span class="o">=</span> <span class="n">RULE_REGISTRY</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span>

            <span class="c1"># Rules are instantiated without arguments here.</span>
            <span class="c1"># They will get their data from the context dict passed to run().</span>
            <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule_class</span><span class="p">())</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_rule_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the index of a rule by its name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the rule to find.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The index of the rule, or `None` if the rule is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all enabled rules in the pipeline sequentially.</span>

<span class="sd">        Each rule is called with the `data` dictionary, which it can modify</span>
<span class="sd">        in-place.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The data dictionary to be processed by the rules. It is</span>
<span class="sd">                expected to contain a &#39;df&#39; key with a pandas DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The modified data dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">rule</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable a rule in the pipeline.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the rule to enable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_rule_index</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable a rule in the pipeline.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the rule to disable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_rule_index</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_rule</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace a rule in the pipeline.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the rule to replace.</span>
<span class="sd">            new_rule: The new rule to insert into the pipeline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_rule_index</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_rule</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.pipeline.SimulationPipeline.disable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Disable a rule in the pipeline.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the rule to disable.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Disable a rule in the pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the rule to disable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_rule_index</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.pipeline.SimulationPipeline.enable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">enable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Enable a rule in the pipeline.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the rule to enable.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enable a rule in the pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the rule to enable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_rule_index</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.pipeline.SimulationPipeline.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Create a SimulationPipeline from a YAML configuration file.</p>
<p>The configuration file should specify a list of rules to be included
in the pipeline. This method uses the RULE_REGISTRY to find and
instantiate the rules. The rules are instantiated without parameters;
they are expected to receive them from the <code>data</code> dictionary during
the <code>run</code> phase.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the YAML configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;SimulationPipeline&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new <code>SimulationPipeline</code> instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SimulationPipeline&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a SimulationPipeline from a YAML configuration file.</span>

<span class="sd">    The configuration file should specify a list of rules to be included</span>
<span class="sd">    in the pipeline. This method uses the RULE_REGISTRY to find and</span>
<span class="sd">    instantiate the rules. The rules are instantiated without parameters;</span>
<span class="sd">    they are expected to receive them from the `data` dictionary during</span>
<span class="sd">    the `run` phase.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_path: The path to the YAML configuration file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new `SimulationPipeline` instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">rules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Import all rule modules to ensure they are registered</span>

    <span class="k">for</span> <span class="n">rule_config</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;rules&quot;</span><span class="p">]:</span>
        <span class="n">rule_name</span> <span class="o">=</span> <span class="n">rule_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rule_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rule_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RULE_REGISTRY</span><span class="p">:</span>
            <span class="c1"># Fallback for old format</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">rule_name</span><span class="p">:</span>
                <span class="n">module_path</span><span class="p">,</span> <span class="n">class_name</span> <span class="o">=</span> <span class="n">rule_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">module_path</span><span class="p">)</span>
                    <span class="n">rule_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown rule: </span><span class="si">{</span><span class="n">rule_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown rule: </span><span class="si">{</span><span class="n">rule_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule_class</span> <span class="o">=</span> <span class="n">RULE_REGISTRY</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span>

        <span class="c1"># Rules are instantiated without arguments here.</span>
        <span class="c1"># They will get their data from the context dict passed to run().</span>
        <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule_class</span><span class="p">())</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.pipeline.SimulationPipeline.replace" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">new_rule</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Replace a rule in the pipeline.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the rule to replace.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_rule</code>
            </td>
            <td>
                  <code><span title="src.rule_registry.Rule">Rule</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new rule to insert into the pipeline.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_rule</span><span class="p">:</span> <span class="n">Rule</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace a rule in the pipeline.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the rule to replace.</span>
<span class="sd">        new_rule: The new rule to insert into the pipeline.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_rule_index</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.pipeline.SimulationPipeline.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Run all enabled rules in the pipeline sequentially.</p>
<p>Each rule is called with the <code>data</code> dictionary, which it can modify
in-place.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data dictionary to be processed by the rules. It is
expected to contain a 'df' key with a pandas DataFrame.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modified data dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run all enabled rules in the pipeline sequentially.</span>

<span class="sd">    Each rule is called with the `data` dictionary, which it can modify</span>
<span class="sd">    in-place.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: The data dictionary to be processed by the rules. It is</span>
<span class="sd">            expected to contain a &#39;df&#39; key with a pandas DataFrame.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The modified data dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">rule</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="main-simulation-logic">Main Simulation Logic</h3>


<div class="doc doc-object doc-module">



<h2 id="src.microsim" class="doc doc-heading">
            <code>src.microsim</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.microsim.calctax" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calctax</span><span class="p">(</span><span class="n">taxy</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">params1</span><span class="p">,</span> <span class="n">params2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate income tax for a year with a mid-year policy change (split year).</p>
<p>This is used when tax rules change during a financial year. It calculates
the tax for the full year under the old rules (<code>params1</code>) and the new rules
(<code>params2</code>), then prorates the results based on the <code>split</code> month.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>taxy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total taxable income for the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>split</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The month number (1-12) in which the tax change occurs. The
new rules apply from this month onwards.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params1</code>
            </td>
            <td>
                  <code><span title="src.parameters.TaxBracketParams">TaxBracketParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tax bracket parameters for the first part of the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params2</code>
            </td>
            <td>
                  <code><span title="src.parameters.TaxBracketParams">TaxBracketParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tax bracket parameters for the second part of the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total income tax for the split year.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/microsim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calctax</span><span class="p">(</span><span class="n">taxy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params1</span><span class="p">:</span> <span class="n">TaxBracketParams</span><span class="p">,</span> <span class="n">params2</span><span class="p">:</span> <span class="n">TaxBracketParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate income tax for a year with a mid-year policy change (split year).</span>

<span class="sd">    This is used when tax rules change during a financial year. It calculates</span>
<span class="sd">    the tax for the full year under the old rules (`params1`) and the new rules</span>
<span class="sd">    (`params2`), then prorates the results based on the `split` month.</span>

<span class="sd">    Args:</span>
<span class="sd">        taxy: The total taxable income for the year.</span>
<span class="sd">        split: The month number (1-12) in which the tax change occurs. The</span>
<span class="sd">            new rules apply from this month onwards.</span>
<span class="sd">        params1: The tax bracket parameters for the first part of the year.</span>
<span class="sd">        params2: The tax bracket parameters for the second part of the year.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The total income tax for the split year.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">taxa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">taxit</span><span class="p">(</span><span class="n">taxy</span><span class="p">,</span> <span class="n">params1</span><span class="p">)</span>
    <span class="n">taxb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">taxit</span><span class="p">(</span><span class="n">taxy</span><span class="p">,</span> <span class="n">params2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">taxa</span> <span class="o">*</span> <span class="p">(</span><span class="n">split</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="n">taxb</span> <span class="o">*</span> <span class="p">((</span><span class="mi">12</span> <span class="o">-</span> <span class="n">split</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.microsim.calculate_net_weekly_income" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_net_weekly_income</span><span class="p">(</span><span class="n">gross_weekly_income</span><span class="p">,</span> <span class="n">acc_earners_premium_rate</span><span class="p">,</span> <span class="n">tax_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the net average weekly income after tax and ACC levy.</p>
<p>This function annualizes the weekly income, calculates the annual income tax,
deducts the ACC Earner's Premium, and then converts the result back to a
weekly net income.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gross_weekly_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The gross weekly income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_earners_premium_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ACC Earner's Premium rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tax_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.TaxBracketParams">TaxBracketParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tax bracket parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The net average weekly income, rounded to two decimal places.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/microsim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_net_weekly_income</span><span class="p">(</span>
    <span class="n">gross_weekly_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">acc_earners_premium_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tax_params</span><span class="p">:</span> <span class="n">TaxBracketParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the net average weekly income after tax and ACC levy.</span>

<span class="sd">    This function annualizes the weekly income, calculates the annual income tax,</span>
<span class="sd">    deducts the ACC Earner&#39;s Premium, and then converts the result back to a</span>
<span class="sd">    weekly net income.</span>

<span class="sd">    Args:</span>
<span class="sd">        gross_weekly_income: The gross weekly income.</span>
<span class="sd">        acc_earners_premium_rate: The ACC Earner&#39;s Premium rate.</span>
<span class="sd">        tax_params: The tax bracket parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The net average weekly income, rounded to two decimal places.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">annual_earnings</span> <span class="o">=</span> <span class="n">gross_weekly_income</span> <span class="o">*</span> <span class="mi">52</span>
    <span class="n">annual_tax</span> <span class="o">=</span> <span class="n">taxit</span><span class="p">(</span><span class="n">annual_earnings</span><span class="p">,</span> <span class="n">tax_params</span><span class="p">)</span>
    <span class="n">net_annual_income</span> <span class="o">=</span> <span class="n">annual_earnings</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">acc_earners_premium_rate</span><span class="p">)</span> <span class="o">-</span> <span class="n">annual_tax</span>
    <span class="n">net_weekly_income</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">net_annual_income</span> <span class="o">/</span> <span class="mi">52</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">net_weekly_income</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.microsim.load_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_parameters</span><span class="p">(</span><span class="n">year</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load policy parameters for <code>year</code> from the SQLite database.</p>
<p>This function connects to the parameters database, queries for all policy
parameters for the given year, reconstructs the parameter dictionary,
and validates it using the Pydantic model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start year for which to load the parameters (e.g., <code>"2023"</code>).
  Note: The input should be the start year as an integer or string,
  not the "YYYY-YYYY" format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Parameters</code></td>            <td>
                  <code><span title="src.parameters.Parameters">Parameters</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Pydantic model containing all parameter groups for the year.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/microsim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_parameters</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load policy parameters for ``year`` from the SQLite database.</span>

<span class="sd">    This function connects to the parameters database, queries for all policy</span>
<span class="sd">    parameters for the given year, reconstructs the parameter dictionary,</span>
<span class="sd">    and validates it using the Pydantic model.</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The start year for which to load the parameters (e.g., ``&quot;2023&quot;``).</span>
<span class="sd">              Note: The input should be the start year as an integer or string,</span>
<span class="sd">              not the &quot;YYYY-YYYY&quot; format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Parameters: A Pydantic model containing all parameter groups for the year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The database stores years as integers (e.g., 2023 for &quot;2023-2024&quot;)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DB_PATH</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameters database not found at </span><span class="si">{</span><span class="n">DB_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_PATH</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT policy_key, parameters FROM policy_parameters WHERE year = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">start_year</span><span class="p">,))</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No parameters found for year </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> in the database.&quot;</span><span class="p">)</span>

    <span class="n">params_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">params_json</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">params_json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">params_json</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Parameters</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">params_dict</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter validation for year </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.microsim.simrwt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simrwt</span><span class="p">(</span><span class="n">interest</span><span class="p">,</span> <span class="n">rwt_rate</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the Resident Withholding Tax (RWT).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>interest</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interest income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rwt_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The RWT rate to apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated RWT.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/microsim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simrwt</span><span class="p">(</span><span class="n">interest</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rwt_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Resident Withholding Tax (RWT).</span>

<span class="sd">    Args:</span>
<span class="sd">        interest (float): The interest income.</span>
<span class="sd">        rwt_rate (float): The RWT rate to apply.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The calculated RWT.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">interest</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">rwt_rate</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;RWT rate must be between 0 and 1.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">interest</span> <span class="o">*</span> <span class="n">rwt_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.microsim.supstd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">supstd</span><span class="p">(</span><span class="n">cpi_factors</span><span class="p">,</span> <span class="n">average_weekly_earnings</span><span class="p">,</span> <span class="n">earner_premium_rates</span><span class="p">,</span> <span class="n">super_floor_relativities</span><span class="p">,</span> <span class="n">tax_parameters</span><span class="p">,</span> <span class="n">base_year_average_weekly_earnings</span><span class="p">,</span> <span class="n">base_year_earner_premium_rate</span><span class="p">,</span> <span class="n">base_year_tax_parameters</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates standard superannuation rates for a base year and 4 simulation years.</p>
<p>This function projects superannuation payments, ensuring they are indexed
to the higher of CPI inflation or a "floor" relative to the average weekly
earnings. It calculates both gross and net superannuation amounts.</p>
<p>This function replicates the logic of the SAS macro <code>%supstd</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cpi_factors</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of 4 CPI factors for the simulation years.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>average_weekly_earnings</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of 4 average weekly earnings for the
simulation years.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>earner_premium_rates</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of 4 ACC earner premium rates for the
simulation years.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>super_floor_relativities</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of 4 superannuation accord floor
relativities for the simulation years.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tax_parameters</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="src.parameters.TaxBracketParams">TaxBracketParams</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of 4 tax parameter sets for the simulation years.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_year_average_weekly_earnings</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The average weekly earnings for the
base year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_year_earner_premium_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ACC earner premium rate for the
base year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_year_tax_parameters</code>
            </td>
            <td>
                  <code><span title="src.parameters.TaxBracketParams">TaxBracketParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tax parameters for the base year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the calculated gross and net standard</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>superannuation amounts for the base year and 4 simulation years.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/microsim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">supstd</span><span class="p">(</span>
    <span class="n">cpi_factors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">average_weekly_earnings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">earner_premium_rates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">super_floor_relativities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">tax_parameters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaxBracketParams</span><span class="p">],</span>
    <span class="n">base_year_average_weekly_earnings</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">base_year_earner_premium_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">base_year_tax_parameters</span><span class="p">:</span> <span class="n">TaxBracketParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates standard superannuation rates for a base year and 4 simulation years.</span>

<span class="sd">    This function projects superannuation payments, ensuring they are indexed</span>
<span class="sd">    to the higher of CPI inflation or a &quot;floor&quot; relative to the average weekly</span>
<span class="sd">    earnings. It calculates both gross and net superannuation amounts.</span>

<span class="sd">    This function replicates the logic of the SAS macro `%supstd`.</span>

<span class="sd">    Args:</span>
<span class="sd">        cpi_factors: A list of 4 CPI factors for the simulation years.</span>
<span class="sd">        average_weekly_earnings: A list of 4 average weekly earnings for the</span>
<span class="sd">            simulation years.</span>
<span class="sd">        earner_premium_rates: A list of 4 ACC earner premium rates for the</span>
<span class="sd">            simulation years.</span>
<span class="sd">        super_floor_relativities: A list of 4 superannuation accord floor</span>
<span class="sd">            relativities for the simulation years.</span>
<span class="sd">        tax_parameters: A list of 4 tax parameter sets for the simulation years.</span>
<span class="sd">        base_year_average_weekly_earnings: The average weekly earnings for the</span>
<span class="sd">            base year.</span>
<span class="sd">        base_year_earner_premium_rate: The ACC earner premium rate for the</span>
<span class="sd">            base year.</span>
<span class="sd">        base_year_tax_parameters: Tax parameters for the base year.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary containing the calculated gross and net standard</span>
<span class="sd">        superannuation amounts for the base year and 4 simulation years.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Base year</span>
    <span class="n">base_year_super</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">base_year_average_weekly_earnings</span> <span class="o">*</span> <span class="mf">0.66</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">base_year_net_super</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">calculate_net_weekly_income</span><span class="p">(</span>
        <span class="n">gross_weekly_income</span><span class="o">=</span><span class="n">base_year_super</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">acc_earners_premium_rate</span><span class="o">=</span><span class="n">base_year_earner_premium_rate</span><span class="p">,</span>
        <span class="n">tax_params</span><span class="o">=</span><span class="n">base_year_tax_parameters</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;std22&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_year_super</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;stdnet22&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_year_net_super</span>

    <span class="c1"># Simulation years</span>
    <span class="n">super_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">net_super_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">previous_super</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">base_year_super</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">current_super</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">average_weekly_earnings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">super_floor_relativities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">previous_super</span> <span class="o">*</span> <span class="n">cpi_factors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">net_super</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">calculate_net_weekly_income</span><span class="p">(</span>
            <span class="n">gross_weekly_income</span><span class="o">=</span><span class="n">current_super</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">acc_earners_premium_rate</span><span class="o">=</span><span class="n">earner_premium_rates</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">tax_params</span><span class="o">=</span><span class="n">tax_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">super_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_super</span><span class="p">)</span>
        <span class="n">net_super_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">net_super</span><span class="p">)</span>
        <span class="n">previous_super</span> <span class="o">=</span> <span class="n">current_super</span>

    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">super_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;stdnet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_super_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;std1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">super_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;stdnet1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_super_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;std2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">super_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;stdnet2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_super_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;std3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">super_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;stdnet3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">net_super_values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.microsim.taxit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">taxit</span><span class="p">(</span><span class="n">taxy</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate income tax using a progressive tax bracket system.</p>
<p>This function iterates through the tax brackets defined in <code>params</code>. For each
bracket, it calculates the tax owed on the portion of income that falls
within that bracket's range. The total tax is the sum of the tax from
each bracket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>taxy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The taxable income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Mapping">Mapping</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | <span title="src.parameters.TaxBracketParams">TaxBracketParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <code>TaxBracketParams</code> instance or a mapping containing
<code>rates</code> and <code>thresholds</code> for the tax brackets.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total calculated income tax.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/microsim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">taxit</span><span class="p">(</span><span class="n">taxy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">TaxBracketParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate income tax using a progressive tax bracket system.</span>

<span class="sd">    This function iterates through the tax brackets defined in `params`. For each</span>
<span class="sd">    bracket, it calculates the tax owed on the portion of income that falls</span>
<span class="sd">    within that bracket&#39;s range. The total tax is the sum of the tax from</span>
<span class="sd">    each bracket.</span>

<span class="sd">    Args:</span>
<span class="sd">        taxy: The taxable income.</span>
<span class="sd">        params: A `TaxBracketParams` instance or a mapping containing</span>
<span class="sd">            `rates` and `thresholds` for the tax brackets.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The total calculated income tax.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">taxy</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">tax_params</span> <span class="o">=</span> <span class="n">_coerce_tax_brackets</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">t_extended</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">+</span> <span class="n">tax_params</span><span class="o">.</span><span class="n">thresholds</span>
    <span class="n">tax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tax_params</span><span class="o">.</span><span class="n">rates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">taxy</span> <span class="o">&gt;</span> <span class="n">t_extended</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_extended</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">taxy</span> <span class="o">&lt;=</span> <span class="n">t_extended</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">tax</span> <span class="o">+=</span> <span class="p">(</span><span class="n">taxy</span> <span class="o">-</span> <span class="n">t_extended</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">rate</span>
                <span class="k">break</span>
            <span class="n">tax</span> <span class="o">+=</span> <span class="p">(</span><span class="n">t_extended</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_extended</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">rate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">tax</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="tax-levy-calculations">Tax &amp; Levy Calculations</h2>
<h3 id="main-tax-calculator">Main Tax Calculator</h3>


<div class="doc doc-object doc-module">



<h2 id="src.tax_calculator" class="doc doc-heading">
            <code>src.tax_calculator</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.tax_calculator.TaxCalculator" class="doc doc-heading">
            <code>TaxCalculator</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Convenience wrapper around core tax calculations.</p>
<p>The class stores a set of policy parameters and exposes small helper
methods which delegate to the functions defined in :mod:<code>microsim</code>.</p>







              <details class="quote">
                <summary>Source code in <code>src/tax_calculator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaxCalculator</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience wrapper around core tax calculations.</span>

<span class="sd">    The class stores a set of policy parameters and exposes small helper</span>
<span class="sd">    methods which delegate to the functions defined in :mod:`microsim`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span><span class="p">:</span> <span class="n">Parameters</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">income_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate income tax for a given taxable income.</span>

<span class="sd">        This method uses a progressive tax system with multiple tax brackets.</span>
<span class="sd">        The tax rates and thresholds for these brackets are drawn from</span>
<span class="sd">        `params.tax_brackets`.</span>

<span class="sd">        The calculation is performed by the `taxit` function.</span>

<span class="sd">        Args:</span>
<span class="sd">            taxable_income: The amount of income to calculate tax on.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The amount of income tax payable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tax_params</span><span class="p">:</span> <span class="n">TaxBracketParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tax_brackets</span>
        <span class="k">return</span> <span class="n">taxit</span><span class="p">(</span><span class="n">taxy</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">tax_params</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ietc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">is_wff_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">is_super_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">is_benefit_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the Independent Earner Tax Credit (IETC).</span>

<span class="sd">        The IETC is a tax credit for individuals who are not receiving</span>
<span class="sd">        certain other benefits, such as Working for Families or NZ Super.</span>

<span class="sd">        The calculation is performed by the `calcietc` function.</span>

<span class="sd">        Args:</span>
<span class="sd">            taxable_income: The individual&#39;s taxable income.</span>
<span class="sd">            is_wff_recipient: Whether the individual is a recipient of</span>
<span class="sd">                Working for Families tax credits.</span>
<span class="sd">            is_super_recipient: Whether the individual is a recipient of</span>
<span class="sd">                NZ Superannuation.</span>
<span class="sd">            is_benefit_recipient: Whether the individual is a recipient of</span>
<span class="sd">                a main benefit.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The amount of IETC the individual is entitled to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ietc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">calcietc</span><span class="p">(</span>
            <span class="n">taxable_income</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span>
            <span class="n">is_wff_recipient</span><span class="o">=</span><span class="n">is_wff_recipient</span><span class="p">,</span>
            <span class="n">is_super_recipient</span><span class="o">=</span><span class="n">is_super_recipient</span><span class="p">,</span>
            <span class="n">is_benefit_recipient</span><span class="o">=</span><span class="n">is_benefit_recipient</span><span class="p">,</span>
            <span class="n">ietc_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ietc</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rwt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interest</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Resident Withholding Tax (RWT) on interest income.</span>

<span class="sd">        RWT is a tax on interest earned from sources like bank accounts and</span>
<span class="sd">        investments. The tax rate depends on the individual&#39;s income tax</span>
<span class="sd">        bracket. This method determines the correct RWT rate based on the</span>
<span class="sd">        provided taxable income and then calculates the RWT amount.</span>

<span class="sd">        Args:</span>
<span class="sd">            interest: The amount of interest income subject to RWT.</span>
<span class="sd">            taxable_income: The individual&#39;s total taxable income, used to</span>
<span class="sd">                determine the RWT rate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The amount of RWT payable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tax_brackets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tax_brackets</span>
        <span class="n">rwt_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">rwt</span>

        <span class="k">if</span> <span class="n">rwt_rates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="c1"># Determine the marginal tax rate to find the corresponding RWT rate.</span>
        <span class="c1"># The last rate in the list applies to all income above the last threshold.</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="n">tax_brackets</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tax_brackets</span><span class="o">.</span><span class="n">thresholds</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">taxable_income</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">tax_brackets</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">break</span>

        <span class="c1"># Map the income tax rate to the corresponding RWT rate.</span>
        <span class="n">rwt_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.105</span><span class="p">):</span>
            <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_10_5</span>
        <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.175</span><span class="p">):</span>
            <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_17_5</span>
        <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">):</span>
            <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_30</span>
        <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">):</span>
            <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_33</span>
        <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">):</span>
            <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_39</span>

        <span class="k">return</span> <span class="n">simrwt</span><span class="p">(</span><span class="n">interest</span><span class="p">,</span> <span class="n">rwt_rate</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">family_boost_credit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">childcare_costs</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the FamilyBoost childcare tax credit.</span>

<span class="sd">        Args:</span>
<span class="sd">            family_income: The total family income.</span>
<span class="sd">            childcare_costs: The total childcare costs for the period.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The calculated FamilyBoost credit amount.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">family_boost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">family_boost_credit</span><span class="p">(</span>
            <span class="n">family_income</span><span class="o">=</span><span class="n">family_income</span><span class="p">,</span>
            <span class="n">childcare_costs</span><span class="o">=</span><span class="n">childcare_costs</span><span class="p">,</span>
            <span class="n">family_boost_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">family_boost</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">eitc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">is_credit_enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">is_eligible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">min_income_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">max_entitlement_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">abatement_income_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">earning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">abatement_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the Earned Income Tax Credit (EITC).</span>

<span class="sd">        Args:</span>
<span class="sd">            is_credit_enabled: Flag to enable or disable the credit calculation.</span>
<span class="sd">            is_eligible: Flag indicating if the individual is eligible for the credit.</span>
<span class="sd">            income: The income amount to base the calculation on.</span>
<span class="sd">            min_income_threshold: The income level at which the credit begins.</span>
<span class="sd">            max_entitlement_income: The income level where the credit reaches its maximum.</span>
<span class="sd">            abatement_income_threshold: The income level at which the credit begins to abate.</span>
<span class="sd">            earning_rate: The rate at which the credit is earned during phase-in.</span>
<span class="sd">            abatement_rate: The rate at which the credit is reduced during phase-out.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The calculated EITC amount.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eitc</span><span class="p">(</span>
            <span class="n">is_credit_enabled</span><span class="o">=</span><span class="n">is_credit_enabled</span><span class="p">,</span>
            <span class="n">is_eligible</span><span class="o">=</span><span class="n">is_eligible</span><span class="p">,</span>
            <span class="n">income</span><span class="o">=</span><span class="n">income</span><span class="p">,</span>
            <span class="n">min_income_threshold</span><span class="o">=</span><span class="n">min_income_threshold</span><span class="p">,</span>
            <span class="n">max_entitlement_income</span><span class="o">=</span><span class="n">max_entitlement_income</span><span class="p">,</span>
            <span class="n">abatement_income_threshold</span><span class="o">=</span><span class="n">abatement_income_threshold</span><span class="p">,</span>
            <span class="n">earning_rate</span><span class="o">=</span><span class="n">earning_rate</span><span class="p">,</span>
            <span class="n">abatement_rate</span><span class="o">=</span><span class="n">abatement_rate</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pie_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pie_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates tax on Portfolio Investment Entity (PIE) income.</span>

<span class="sd">        Args:</span>
<span class="sd">            pie_income: The income from the PIE investment.</span>
<span class="sd">            taxable_income: The individual&#39;s total taxable income for the year,</span>
<span class="sd">                used to determine the Prescribed Investor Rate (PIR).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The calculated tax on the PIE income. Returns 0 if PIE parameters</span>
<span class="sd">            are not available for the year.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pie</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">calculate_pie_tax</span><span class="p">(</span>
            <span class="n">pie_income</span><span class="o">=</span><span class="n">pie_income</span><span class="p">,</span>
            <span class="n">taxable_income</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span>
            <span class="n">pie_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pie</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">donation_credit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_donations</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the tax credit for charitable donations.</span>

<span class="sd">        Args:</span>
<span class="sd">            total_donations: The total amount of donations made in the year.</span>
<span class="sd">            taxable_income: The individual&#39;s total taxable income for the year.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The calculated donation tax credit. Returns 0 if donation credit</span>
<span class="sd">            parameters are not available for the year.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">donation_credit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">calculate_donation_credit</span><span class="p">(</span>
            <span class="n">total_donations</span><span class="o">=</span><span class="n">total_donations</span><span class="p">,</span>
            <span class="n">taxable_income</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">donation_credit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_net_income</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to calculate net income for a single individual.&quot;&quot;&quot;</span>
        <span class="c1"># This is a simplified calculation and assumes individual_data contains all necessary fields.</span>
        <span class="c1"># A more robust implementation would handle missing keys gracefully.</span>

        <span class="n">income</span> <span class="o">=</span> <span class="n">individual_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Calculate taxes</span>
        <span class="n">tax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">income_tax</span><span class="p">(</span><span class="n">income</span><span class="p">)</span>
        <span class="c1"># In a real model, we would also include ACC levies etc.</span>

        <span class="c1"># Calculate benefits</span>
        <span class="c1"># This is highly simplified. A real calculation would need family context.</span>
        <span class="n">benefits</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ietc</span><span class="p">:</span>
            <span class="n">benefits</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ietc</span><span class="p">(</span>
                <span class="n">taxable_income</span><span class="o">=</span><span class="n">income</span><span class="p">,</span>
                <span class="n">is_wff_recipient</span><span class="o">=</span><span class="n">individual_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_wff_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="n">is_super_recipient</span><span class="o">=</span><span class="n">individual_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_super_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="n">is_benefit_recipient</span><span class="o">=</span><span class="n">individual_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_benefit_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="c1"># In a real model, we would add all other relevant benefits (WFF, etc.)</span>

        <span class="n">net_income</span> <span class="o">=</span> <span class="n">income</span> <span class="o">-</span> <span class="n">tax</span> <span class="o">+</span> <span class="n">benefits</span>
        <span class="k">return</span> <span class="n">net_income</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_emtr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the Effective Marginal Tax Rate (EMTR) for an individual.</span>

<span class="sd">        The EMTR is the proportion of an additional dollar of earnings that is</span>
<span class="sd">        lost to taxes and reduced benefits. It is calculated by simulating the</span>
<span class="sd">        individual&#39;s net income with and without a small increase in income.</span>

<span class="sd">        Args:</span>
<span class="sd">            individual_data: A dictionary representing a single person,</span>
<span class="sd">                containing all necessary fields for tax and benefit calculations</span>
<span class="sd">                (e.g., &#39;income&#39;, &#39;age&#39;, etc.).</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Effective Marginal Tax Rate as a float (e.g., 0.3 for 30%).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Calculate net income at the original income level</span>
        <span class="n">net_income_original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_net_income</span><span class="p">(</span><span class="n">individual_data</span><span class="p">)</span>

        <span class="c1"># 2. Calculate net income at a slightly higher income level</span>
        <span class="n">data_plus_one</span> <span class="o">=</span> <span class="n">individual_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data_plus_one</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_plus_one</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">net_income_plus_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_net_income</span><span class="p">(</span><span class="n">data_plus_one</span><span class="p">)</span>

        <span class="c1"># 3. Calculate the change in net income</span>
        <span class="n">change_in_net_income</span> <span class="o">=</span> <span class="n">net_income_plus_one</span> <span class="o">-</span> <span class="n">net_income_original</span>

        <span class="c1"># 4. The EMTR is 1 minus the change in net income</span>
        <span class="c1"># This represents the fraction of the extra dollar that was &quot;lost&quot;.</span>
        <span class="n">emtr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">change_in_net_income</span>

        <span class="k">return</span> <span class="n">emtr</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_year</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TaxCalculator&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a :class:`TaxCalculator` from stored parameter files.</span>

<span class="sd">        This method loads the parameters for a given tax year from the</span>
<span class="sd">        corresponding JSON file (e.g., `parameters_2023-2024.json`).</span>

<span class="sd">        Args:</span>
<span class="sd">            year: The tax year to load parameters for (e.g., &quot;2023-2024&quot;).</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new `TaxCalculator` instance with the loaded parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">load_parameters</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.calculate_emtr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_emtr</span><span class="p">(</span><span class="n">individual_data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculates the Effective Marginal Tax Rate (EMTR) for an individual.</p>
<p>The EMTR is the proportion of an additional dollar of earnings that is
lost to taxes and reduced benefits. It is calculated by simulating the
individual's net income with and without a small increase in income.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>individual_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary representing a single person,
containing all necessary fields for tax and benefit calculations
(e.g., 'income', 'age', etc.).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Effective Marginal Tax Rate as a float (e.g., 0.3 for 30%).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_emtr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Effective Marginal Tax Rate (EMTR) for an individual.</span>

<span class="sd">    The EMTR is the proportion of an additional dollar of earnings that is</span>
<span class="sd">    lost to taxes and reduced benefits. It is calculated by simulating the</span>
<span class="sd">    individual&#39;s net income with and without a small increase in income.</span>

<span class="sd">    Args:</span>
<span class="sd">        individual_data: A dictionary representing a single person,</span>
<span class="sd">            containing all necessary fields for tax and benefit calculations</span>
<span class="sd">            (e.g., &#39;income&#39;, &#39;age&#39;, etc.).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Effective Marginal Tax Rate as a float (e.g., 0.3 for 30%).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. Calculate net income at the original income level</span>
    <span class="n">net_income_original</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_net_income</span><span class="p">(</span><span class="n">individual_data</span><span class="p">)</span>

    <span class="c1"># 2. Calculate net income at a slightly higher income level</span>
    <span class="n">data_plus_one</span> <span class="o">=</span> <span class="n">individual_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_plus_one</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_plus_one</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">net_income_plus_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_net_income</span><span class="p">(</span><span class="n">data_plus_one</span><span class="p">)</span>

    <span class="c1"># 3. Calculate the change in net income</span>
    <span class="n">change_in_net_income</span> <span class="o">=</span> <span class="n">net_income_plus_one</span> <span class="o">-</span> <span class="n">net_income_original</span>

    <span class="c1"># 4. The EMTR is 1 minus the change in net income</span>
    <span class="c1"># This represents the fraction of the extra dollar that was &quot;lost&quot;.</span>
    <span class="n">emtr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">change_in_net_income</span>

    <span class="k">return</span> <span class="n">emtr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.donation_credit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">donation_credit</span><span class="p">(</span><span class="n">total_donations</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculates the tax credit for charitable donations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>total_donations</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total amount of donations made in the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's total taxable income for the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated donation tax credit. Returns 0 if donation credit</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameters are not available for the year.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">donation_credit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_donations</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the tax credit for charitable donations.</span>

<span class="sd">    Args:</span>
<span class="sd">        total_donations: The total amount of donations made in the year.</span>
<span class="sd">        taxable_income: The individual&#39;s total taxable income for the year.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated donation tax credit. Returns 0 if donation credit</span>
<span class="sd">        parameters are not available for the year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">donation_credit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">calculate_donation_credit</span><span class="p">(</span>
        <span class="n">total_donations</span><span class="o">=</span><span class="n">total_donations</span><span class="p">,</span>
        <span class="n">taxable_income</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">donation_credit</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.eitc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eitc</span><span class="p">(</span><span class="n">is_credit_enabled</span><span class="p">,</span> <span class="n">is_eligible</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">min_income_threshold</span><span class="p">,</span> <span class="n">max_entitlement_income</span><span class="p">,</span> <span class="n">abatement_income_threshold</span><span class="p">,</span> <span class="n">earning_rate</span><span class="p">,</span> <span class="n">abatement_rate</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculates the Earned Income Tax Credit (EITC).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_credit_enabled</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to enable or disable the credit calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_eligible</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating if the individual is eligible for the credit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income amount to base the calculation on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_income_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income level at which the credit begins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_entitlement_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income level where the credit reaches its maximum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abatement_income_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income level at which the credit begins to abate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>earning_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rate at which the credit is earned during phase-in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abatement_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rate at which the credit is reduced during phase-out.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated EITC amount.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eitc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">is_credit_enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_eligible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">min_income_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_entitlement_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">abatement_income_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">earning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">abatement_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Earned Income Tax Credit (EITC).</span>

<span class="sd">    Args:</span>
<span class="sd">        is_credit_enabled: Flag to enable or disable the credit calculation.</span>
<span class="sd">        is_eligible: Flag indicating if the individual is eligible for the credit.</span>
<span class="sd">        income: The income amount to base the calculation on.</span>
<span class="sd">        min_income_threshold: The income level at which the credit begins.</span>
<span class="sd">        max_entitlement_income: The income level where the credit reaches its maximum.</span>
<span class="sd">        abatement_income_threshold: The income level at which the credit begins to abate.</span>
<span class="sd">        earning_rate: The rate at which the credit is earned during phase-in.</span>
<span class="sd">        abatement_rate: The rate at which the credit is reduced during phase-out.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated EITC amount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">eitc</span><span class="p">(</span>
        <span class="n">is_credit_enabled</span><span class="o">=</span><span class="n">is_credit_enabled</span><span class="p">,</span>
        <span class="n">is_eligible</span><span class="o">=</span><span class="n">is_eligible</span><span class="p">,</span>
        <span class="n">income</span><span class="o">=</span><span class="n">income</span><span class="p">,</span>
        <span class="n">min_income_threshold</span><span class="o">=</span><span class="n">min_income_threshold</span><span class="p">,</span>
        <span class="n">max_entitlement_income</span><span class="o">=</span><span class="n">max_entitlement_income</span><span class="p">,</span>
        <span class="n">abatement_income_threshold</span><span class="o">=</span><span class="n">abatement_income_threshold</span><span class="p">,</span>
        <span class="n">earning_rate</span><span class="o">=</span><span class="n">earning_rate</span><span class="p">,</span>
        <span class="n">abatement_rate</span><span class="o">=</span><span class="n">abatement_rate</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.family_boost_credit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">family_boost_credit</span><span class="p">(</span><span class="n">family_income</span><span class="p">,</span> <span class="n">childcare_costs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculates the FamilyBoost childcare tax credit.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>family_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total family income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>childcare_costs</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total childcare costs for the period.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated FamilyBoost credit amount.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">family_boost_credit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">childcare_costs</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the FamilyBoost childcare tax credit.</span>

<span class="sd">    Args:</span>
<span class="sd">        family_income: The total family income.</span>
<span class="sd">        childcare_costs: The total childcare costs for the period.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated FamilyBoost credit amount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">family_boost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">family_boost_credit</span><span class="p">(</span>
        <span class="n">family_income</span><span class="o">=</span><span class="n">family_income</span><span class="p">,</span>
        <span class="n">childcare_costs</span><span class="o">=</span><span class="n">childcare_costs</span><span class="p">,</span>
        <span class="n">family_boost_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">family_boost</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.from_year" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_year</span><span class="p">(</span><span class="n">year</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Construct a :class:<code>TaxCalculator</code> from stored parameter files.</p>
<p>This method loads the parameters for a given tax year from the
corresponding JSON file (e.g., <code>parameters_2023-2024.json</code>).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tax year to load parameters for (e.g., "2023-2024").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;TaxCalculator&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new <code>TaxCalculator</code> instance with the loaded parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_year</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TaxCalculator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a :class:`TaxCalculator` from stored parameter files.</span>

<span class="sd">    This method loads the parameters for a given tax year from the</span>
<span class="sd">    corresponding JSON file (e.g., `parameters_2023-2024.json`).</span>

<span class="sd">    Args:</span>
<span class="sd">        year: The tax year to load parameters for (e.g., &quot;2023-2024&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new `TaxCalculator` instance with the loaded parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">load_parameters</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.ietc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ietc</span><span class="p">(</span><span class="n">taxable_income</span><span class="p">,</span> <span class="n">is_wff_recipient</span><span class="p">,</span> <span class="n">is_super_recipient</span><span class="p">,</span> <span class="n">is_benefit_recipient</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate the Independent Earner Tax Credit (IETC).</p>
<p>The IETC is a tax credit for individuals who are not receiving
certain other benefits, such as Working for Families or NZ Super.</p>
<p>The calculation is performed by the <code>calcietc</code> function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's taxable income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_wff_recipient</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is a recipient of
Working for Families tax credits.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_super_recipient</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is a recipient of
NZ Superannuation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_benefit_recipient</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is a recipient of
a main benefit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of IETC the individual is entitled to.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ietc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">is_wff_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_super_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_benefit_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Independent Earner Tax Credit (IETC).</span>

<span class="sd">    The IETC is a tax credit for individuals who are not receiving</span>
<span class="sd">    certain other benefits, such as Working for Families or NZ Super.</span>

<span class="sd">    The calculation is performed by the `calcietc` function.</span>

<span class="sd">    Args:</span>
<span class="sd">        taxable_income: The individual&#39;s taxable income.</span>
<span class="sd">        is_wff_recipient: Whether the individual is a recipient of</span>
<span class="sd">            Working for Families tax credits.</span>
<span class="sd">        is_super_recipient: Whether the individual is a recipient of</span>
<span class="sd">            NZ Superannuation.</span>
<span class="sd">        is_benefit_recipient: Whether the individual is a recipient of</span>
<span class="sd">            a main benefit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The amount of IETC the individual is entitled to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ietc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">calcietc</span><span class="p">(</span>
        <span class="n">taxable_income</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span>
        <span class="n">is_wff_recipient</span><span class="o">=</span><span class="n">is_wff_recipient</span><span class="p">,</span>
        <span class="n">is_super_recipient</span><span class="o">=</span><span class="n">is_super_recipient</span><span class="p">,</span>
        <span class="n">is_benefit_recipient</span><span class="o">=</span><span class="n">is_benefit_recipient</span><span class="p">,</span>
        <span class="n">ietc_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ietc</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.income_tax" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">income_tax</span><span class="p">(</span><span class="n">taxable_income</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate income tax for a given taxable income.</p>
<p>This method uses a progressive tax system with multiple tax brackets.
The tax rates and thresholds for these brackets are drawn from
<code>params.tax_brackets</code>.</p>
<p>The calculation is performed by the <code>taxit</code> function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of income to calculate tax on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of income tax payable.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">income_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate income tax for a given taxable income.</span>

<span class="sd">    This method uses a progressive tax system with multiple tax brackets.</span>
<span class="sd">    The tax rates and thresholds for these brackets are drawn from</span>
<span class="sd">    `params.tax_brackets`.</span>

<span class="sd">    The calculation is performed by the `taxit` function.</span>

<span class="sd">    Args:</span>
<span class="sd">        taxable_income: The amount of income to calculate tax on.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The amount of income tax payable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tax_params</span><span class="p">:</span> <span class="n">TaxBracketParams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tax_brackets</span>
    <span class="k">return</span> <span class="n">taxit</span><span class="p">(</span><span class="n">taxy</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">tax_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.pie_tax" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pie_tax</span><span class="p">(</span><span class="n">pie_income</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculates tax on Portfolio Investment Entity (PIE) income.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pie_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income from the PIE investment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's total taxable income for the year,
used to determine the Prescribed Investor Rate (PIR).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated tax on the PIE income. Returns 0 if PIE parameters</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>are not available for the year.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pie_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pie_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates tax on Portfolio Investment Entity (PIE) income.</span>

<span class="sd">    Args:</span>
<span class="sd">        pie_income: The income from the PIE investment.</span>
<span class="sd">        taxable_income: The individual&#39;s total taxable income for the year,</span>
<span class="sd">            used to determine the Prescribed Investor Rate (PIR).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated tax on the PIE income. Returns 0 if PIE parameters</span>
<span class="sd">        are not available for the year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pie</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">calculate_pie_tax</span><span class="p">(</span>
        <span class="n">pie_income</span><span class="o">=</span><span class="n">pie_income</span><span class="p">,</span>
        <span class="n">taxable_income</span><span class="o">=</span><span class="n">taxable_income</span><span class="p">,</span>
        <span class="n">pie_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pie</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.tax_calculator.TaxCalculator.rwt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rwt</span><span class="p">(</span><span class="n">interest</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate Resident Withholding Tax (RWT) on interest income.</p>
<p>RWT is a tax on interest earned from sources like bank accounts and
investments. The tax rate depends on the individual's income tax
bracket. This method determines the correct RWT rate based on the
provided taxable income and then calculates the RWT amount.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>interest</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of interest income subject to RWT.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's total taxable income, used to
determine the RWT rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of RWT payable.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_calculator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rwt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interest</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Resident Withholding Tax (RWT) on interest income.</span>

<span class="sd">    RWT is a tax on interest earned from sources like bank accounts and</span>
<span class="sd">    investments. The tax rate depends on the individual&#39;s income tax</span>
<span class="sd">    bracket. This method determines the correct RWT rate based on the</span>
<span class="sd">    provided taxable income and then calculates the RWT amount.</span>

<span class="sd">    Args:</span>
<span class="sd">        interest: The amount of interest income subject to RWT.</span>
<span class="sd">        taxable_income: The individual&#39;s total taxable income, used to</span>
<span class="sd">            determine the RWT rate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The amount of RWT payable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tax_brackets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">tax_brackets</span>
    <span class="n">rwt_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">rwt</span>

    <span class="k">if</span> <span class="n">rwt_rates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="c1"># Determine the marginal tax rate to find the corresponding RWT rate.</span>
    <span class="c1"># The last rate in the list applies to all income above the last threshold.</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">tax_brackets</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tax_brackets</span><span class="o">.</span><span class="n">thresholds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">taxable_income</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">tax_brackets</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">break</span>

    <span class="c1"># Map the income tax rate to the corresponding RWT rate.</span>
    <span class="n">rwt_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.105</span><span class="p">):</span>
        <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_10_5</span>
    <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.175</span><span class="p">):</span>
        <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_17_5</span>
    <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">):</span>
        <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_30</span>
    <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">):</span>
        <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_33</span>
    <span class="k">elif</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">):</span>
        <span class="n">rwt_rate</span> <span class="o">=</span> <span class="n">rwt_rates</span><span class="o">.</span><span class="n">rwt_rate_39</span>

    <span class="k">return</span> <span class="n">simrwt</span><span class="p">(</span><span class="n">interest</span><span class="p">,</span> <span class="n">rwt_rate</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="tax-credits">Tax Credits</h3>


<div class="doc doc-object doc-module">



<h2 id="src.tax_credits" class="doc doc-heading">
            <code>src.tax_credits</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.tax_credits.calcietc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calcietc</span><span class="p">(</span><span class="n">taxable_income</span><span class="p">,</span> <span class="n">is_wff_recipient</span><span class="p">,</span> <span class="n">is_super_recipient</span><span class="p">,</span> <span class="n">is_benefit_recipient</span><span class="p">,</span> <span class="n">ietc_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the Independent Earner Tax Credit (IETC).</p>
<p>This function determines the IETC entitlement based on taxable income and
eligibility criteria. It replicates the logic of the SAS macro <code>%calcietc</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's taxable income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_wff_recipient</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the individual receives Working for Families tax credits.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_super_recipient</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the individual receives superannuation payments.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_benefit_recipient</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the individual receives a main benefit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ietc_params</code>
            </td>
            <td>
                  <code><span title="typing.Mapping">Mapping</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | <span title="src.parameters.IETCParams">IETCParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Structured IETC parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated IETC amount.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_credits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calcietc</span><span class="p">(</span>
    <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">is_wff_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_super_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_benefit_recipient</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">ietc_params</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">IETCParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Independent Earner Tax Credit (IETC).</span>

<span class="sd">    This function determines the IETC entitlement based on taxable income and</span>
<span class="sd">    eligibility criteria. It replicates the logic of the SAS macro `%calcietc`.</span>

<span class="sd">    Args:</span>
<span class="sd">        taxable_income (float): The individual&#39;s taxable income.</span>
<span class="sd">        is_wff_recipient (bool): True if the individual receives Working for Families tax credits.</span>
<span class="sd">        is_super_recipient (bool): True if the individual receives superannuation payments.</span>
<span class="sd">        is_benefit_recipient (bool): True if the individual receives a main benefit.</span>
<span class="sd">        ietc_params: Structured IETC parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The calculated IETC amount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># IETC is not available to recipients of WFF, superannuation, or main benefits.</span>
    <span class="k">if</span> <span class="n">is_wff_recipient</span> <span class="ow">or</span> <span class="n">is_super_recipient</span> <span class="ow">or</span> <span class="n">is_benefit_recipient</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">_coerce_ietc</span><span class="p">(</span><span class="n">ietc_params</span><span class="p">)</span>
    <span class="n">income_threshold_min</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">thrin</span>
    <span class="n">income_threshold_max</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">thrab</span>
    <span class="n">max_entitlement</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">ent</span>
    <span class="n">abatement_rate</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">abrate</span>

    <span class="c1"># Calculate IETC based on income thresholds.</span>
    <span class="k">if</span> <span class="n">taxable_income</span> <span class="o">&lt;=</span> <span class="n">income_threshold_min</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">taxable_income</span> <span class="o">&lt;=</span> <span class="n">income_threshold_max</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">max_entitlement</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Abate the credit for income above the maximum threshold.</span>
        <span class="n">abatement</span> <span class="o">=</span> <span class="p">(</span><span class="n">taxable_income</span> <span class="o">-</span> <span class="n">income_threshold_max</span><span class="p">)</span> <span class="o">*</span> <span class="n">abatement_rate</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_entitlement</span> <span class="o">-</span> <span class="n">abatement</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.tax_credits.calculate_donation_credit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_donation_credit</span><span class="p">(</span><span class="n">total_donations</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the tax credit for charitable donations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>total_donations</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total amount of donations made in the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's total taxable income for the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="src.parameters.DonationCreditParams">DonationCreditParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the donation tax credit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated donation tax credit.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_credits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_donation_credit</span><span class="p">(</span>
    <span class="n">total_donations</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">DonationCreditParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the tax credit for charitable donations.</span>

<span class="sd">    Args:</span>
<span class="sd">        total_donations: The total amount of donations made in the year.</span>
<span class="sd">        taxable_income: The individual&#39;s total taxable income for the year.</span>
<span class="sd">        params: The parameters for the donation tax credit.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated donation tax credit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">total_donations</span> <span class="o">&lt;</span> <span class="n">params</span><span class="o">.</span><span class="n">min_donation</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">eligible_amount</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_donations</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eligible_amount</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">credit_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.tax_credits.eitc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eitc</span><span class="p">(</span><span class="n">is_credit_enabled</span><span class="p">,</span> <span class="n">is_eligible</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">min_income_threshold</span><span class="p">,</span> <span class="n">max_entitlement_income</span><span class="p">,</span> <span class="n">abatement_income_threshold</span><span class="p">,</span> <span class="n">earning_rate</span><span class="p">,</span> <span class="n">abatement_rate</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the Earned Income Tax Credit (EITC).</p>
<p>The EITC calculation has three phases based on income:
1.  <strong>Phase-in:</strong> For income between <code>min_income_threshold</code> and
    <code>max_entitlement_income</code>, the credit increases at the <code>earning_rate</code>.
2.  <strong>Plateau:</strong> For income between <code>max_entitlement_income</code> and
    <code>abatement_income_threshold</code>, the credit is at its maximum.
3.  <strong>Phase-out:</strong> For income above <code>abatement_income_threshold</code>, the
    credit is reduced at the <code>abatement_rate</code>.</p>
<p>This function replicates the logic of the SAS macro <code>%eitc</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_credit_enabled</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to enable or disable the credit calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_eligible</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating if the individual is eligible for the credit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income amount to base the calculation on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_income_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income level at which the credit begins.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_entitlement_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income level where the credit reaches its maximum.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abatement_income_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income level at which the credit begins to abate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>earning_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rate at which the credit is earned during phase-in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abatement_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rate at which the credit is reduced during phase-out.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated EITC amount.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_credits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">eitc</span><span class="p">(</span>
    <span class="n">is_credit_enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_eligible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">min_income_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_entitlement_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">abatement_income_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">earning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">abatement_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Earned Income Tax Credit (EITC).</span>

<span class="sd">    The EITC calculation has three phases based on income:</span>
<span class="sd">    1.  **Phase-in:** For income between `min_income_threshold` and</span>
<span class="sd">        `max_entitlement_income`, the credit increases at the `earning_rate`.</span>
<span class="sd">    2.  **Plateau:** For income between `max_entitlement_income` and</span>
<span class="sd">        `abatement_income_threshold`, the credit is at its maximum.</span>
<span class="sd">    3.  **Phase-out:** For income above `abatement_income_threshold`, the</span>
<span class="sd">        credit is reduced at the `abatement_rate`.</span>

<span class="sd">    This function replicates the logic of the SAS macro `%eitc`.</span>

<span class="sd">    Args:</span>
<span class="sd">        is_credit_enabled: Flag to enable or disable the credit calculation.</span>
<span class="sd">        is_eligible: Flag indicating if the individual is eligible for the credit.</span>
<span class="sd">        income: The income amount to base the calculation on.</span>
<span class="sd">        min_income_threshold: The income level at which the credit begins.</span>
<span class="sd">        max_entitlement_income: The income level where the credit reaches its maximum.</span>
<span class="sd">        abatement_income_threshold: The income level at which the credit begins to abate.</span>
<span class="sd">        earning_rate: The rate at which the credit is earned during phase-in.</span>
<span class="sd">        abatement_rate: The rate at which the credit is reduced during phase-out.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated EITC amount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_credit_enabled</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_eligible</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="n">min_income_threshold</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="n">max_entitlement_income</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">earning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">min_income_threshold</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="n">abatement_income_threshold</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">max_entitlement_income</span> <span class="o">-</span> <span class="n">min_income_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">earning_rate</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
            <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">(</span><span class="n">max_entitlement_income</span> <span class="o">-</span> <span class="n">min_income_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">earning_rate</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">abatement_income_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">abatement_rate</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.tax_credits.family_boost_credit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">family_boost_credit</span><span class="p">(</span><span class="n">family_income</span><span class="p">,</span> <span class="n">childcare_costs</span><span class="p">,</span> <span class="n">family_boost_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the FamilyBoost childcare tax credit.</p>
<p>The credit is calculated as 25% of childcare costs, up to a maximum
credit amount. The credit is then abated for families with income above
a certain threshold.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>family_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total family income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>childcare_costs</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total childcare costs for the period.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>family_boost_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.FamilyBoostParams">FamilyBoostParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the FamilyBoost credit,
including max credit, income thresholds, and abatement rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated FamilyBoost credit amount.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/tax_credits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">family_boost_credit</span><span class="p">(</span>
    <span class="n">family_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">childcare_costs</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">family_boost_params</span><span class="p">:</span> <span class="n">FamilyBoostParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the FamilyBoost childcare tax credit.</span>

<span class="sd">    The credit is calculated as 25% of childcare costs, up to a maximum</span>
<span class="sd">    credit amount. The credit is then abated for families with income above</span>
<span class="sd">    a certain threshold.</span>

<span class="sd">    Args:</span>
<span class="sd">        family_income: The total family income.</span>
<span class="sd">        childcare_costs: The total childcare costs for the period.</span>
<span class="sd">        family_boost_params: The parameters for the FamilyBoost credit,</span>
<span class="sd">            including max credit, income thresholds, and abatement rate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated FamilyBoost credit amount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_credit</span> <span class="o">=</span> <span class="n">family_boost_params</span><span class="o">.</span><span class="n">max_credit</span>
    <span class="n">income_threshold</span> <span class="o">=</span> <span class="n">family_boost_params</span><span class="o">.</span><span class="n">income_threshold</span>
    <span class="n">abatement_rate</span> <span class="o">=</span> <span class="n">family_boost_params</span><span class="o">.</span><span class="n">abatement_rate</span>
    <span class="n">max_income</span> <span class="o">=</span> <span class="n">family_boost_params</span><span class="o">.</span><span class="n">max_income</span>

    <span class="k">if</span> <span class="n">family_income</span> <span class="o">&gt;</span> <span class="n">max_income</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">credit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">childcare_costs</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">max_credit</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">family_income</span> <span class="o">&gt;</span> <span class="n">income_threshold</span><span class="p">:</span>
        <span class="n">abatement</span> <span class="o">=</span> <span class="p">(</span><span class="n">family_income</span> <span class="o">-</span> <span class="n">income_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">abatement_rate</span>
        <span class="n">credit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">credit</span> <span class="o">-</span> <span class="n">abatement</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">credit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="acc-levy">ACC Levy</h3>


<div class="doc doc-object doc-module">



<h2 id="src.acc_levy" class="doc doc-heading">
            <code>src.acc_levy</code>


</h2>

    <div class="doc doc-contents first">

        <p>ACC earner's levy calculations.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.acc_levy.calculate_acc_levy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_acc_levy</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">levy_rate</span><span class="p">,</span> <span class="n">max_income</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the ACC (Accident Compensation Corporation) earner's levy.</p>
<p>The ACC earner's levy is a compulsory payment that helps fund the cost of
accidents in New Zealand. It is calculated as a flat rate on income up to
a specified maximum.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual earnings subject to the levy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>levy_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ACC levy rate, expressed as a decimal (e.g., 1.46%
is 0.0146).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum income on which the levy is charged.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total ACC levy owed for the year.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/acc_levy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_acc_levy</span><span class="p">(</span><span class="n">income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">levy_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the ACC (Accident Compensation Corporation) earner&#39;s levy.</span>

<span class="sd">    The ACC earner&#39;s levy is a compulsory payment that helps fund the cost of</span>
<span class="sd">    accidents in New Zealand. It is calculated as a flat rate on income up to</span>
<span class="sd">    a specified maximum.</span>

<span class="sd">    Args:</span>
<span class="sd">        income: The annual earnings subject to the levy.</span>
<span class="sd">        levy_rate: The ACC levy rate, expressed as a decimal (e.g., 1.46%</span>
<span class="sd">            is 0.0146).</span>
<span class="sd">        max_income: The maximum income on which the levy is charged.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The total ACC levy owed for the year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">levy_rate</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">max_income</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">chargeable_income</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">max_income</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chargeable_income</span> <span class="o">*</span> <span class="n">levy_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.acc_levy.calculate_payroll_deductions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_payroll_deductions</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">tax_params</span><span class="p">,</span> <span class="n">levy_rate</span><span class="p">,</span> <span class="n">levy_max_income</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate total payroll deductions, including income tax and ACC levy.</p>
<p>This function provides a combined calculation of the two main deductions
from an individual's income: income tax and the ACC earner's levy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tax_params</code>
            </td>
            <td>
                  <code>&#39;TaxBracketParams&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tax bracket parameters for the income tax calculation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>levy_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ACC levy rate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>levy_max_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum income for the ACC levy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total amount of payroll deductions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/acc_levy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_payroll_deductions</span><span class="p">(</span>
    <span class="n">income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tax_params</span><span class="p">:</span> <span class="s2">&quot;TaxBracketParams&quot;</span><span class="p">,</span>
    <span class="n">levy_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">levy_max_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate total payroll deductions, including income tax and ACC levy.</span>

<span class="sd">    This function provides a combined calculation of the two main deductions</span>
<span class="sd">    from an individual&#39;s income: income tax and the ACC earner&#39;s levy.</span>

<span class="sd">    Args:</span>
<span class="sd">        income: The annual income.</span>
<span class="sd">        tax_params: The tax bracket parameters for the income tax calculation.</span>
<span class="sd">        levy_rate: The ACC levy rate.</span>
<span class="sd">        levy_max_income: The maximum income for the ACC levy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The total amount of payroll deductions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.microsim</span><span class="w"> </span><span class="kn">import</span> <span class="n">taxit</span>

    <span class="n">income_tax</span> <span class="o">=</span> <span class="n">taxit</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">tax_params</span><span class="p">)</span>
    <span class="n">levy</span> <span class="o">=</span> <span class="n">calculate_acc_levy</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">levy_rate</span><span class="p">,</span> <span class="n">levy_max_income</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">income_tax</span> <span class="o">+</span> <span class="n">levy</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="investment-income-tax-pie">Investment Income Tax (PIE)</h3>


<div class="doc doc-object doc-module">



<h2 id="src.investment_tax" class="doc doc-heading">
            <code>src.investment_tax</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.investment_tax.calculate_pie_tax" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_pie_tax</span><span class="p">(</span><span class="n">pie_income</span><span class="p">,</span> <span class="n">taxable_income</span><span class="p">,</span> <span class="n">pie_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates tax on Portfolio Investment Entity (PIE) income.</p>
<p>This function determines the Prescribed Investor Rate (PIR) based on the
individual's taxable income and then calculates the tax on the PIE income.</p>
<p>.. warning::
    The current implementation uses a simplified logic based on a single
    year's income to determine the PIR. The official IRD rules require
    looking at income from the two preceding years. This implementation
    should be updated when the definitive two-year lookback logic is
    clarified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pie_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income from the PIE investment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taxable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's total taxable income for the year.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pie_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.PIEParams">PIEParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for PIE tax, including rates and thresholds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated tax on the PIE income.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/investment_tax.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_pie_tax</span><span class="p">(</span>
    <span class="n">pie_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">taxable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pie_params</span><span class="p">:</span> <span class="n">PIEParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates tax on Portfolio Investment Entity (PIE) income.</span>

<span class="sd">    This function determines the Prescribed Investor Rate (PIR) based on the</span>
<span class="sd">    individual&#39;s taxable income and then calculates the tax on the PIE income.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        The current implementation uses a simplified logic based on a single</span>
<span class="sd">        year&#39;s income to determine the PIR. The official IRD rules require</span>
<span class="sd">        looking at income from the two preceding years. This implementation</span>
<span class="sd">        should be updated when the definitive two-year lookback logic is</span>
<span class="sd">        clarified.</span>

<span class="sd">    Args:</span>
<span class="sd">        pie_income: The income from the PIE investment.</span>
<span class="sd">        taxable_income: The individual&#39;s total taxable income for the year.</span>
<span class="sd">        pie_params: The parameters for PIE tax, including rates and thresholds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated tax on the PIE income.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pie_income</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">total_income</span> <span class="o">=</span> <span class="n">taxable_income</span> <span class="o">+</span> <span class="n">pie_income</span>

    <span class="c1"># Determine the PIR rate based on income thresholds.</span>
    <span class="c1"># This is a simplified logic. The official rules are more complex.</span>
    <span class="n">pir</span> <span class="o">=</span> <span class="n">pie_params</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Default to the highest rate</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">taxable_thresh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pie_params</span><span class="o">.</span><span class="n">taxable_income_thresholds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">taxable_income</span> <span class="o">&lt;=</span> <span class="n">taxable_thresh</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">total_income</span> <span class="o">&lt;=</span> <span class="n">pie_params</span><span class="o">.</span><span class="n">taxable_plus_pie_income_thresholds</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">pir</span> <span class="o">=</span> <span class="n">pie_params</span><span class="o">.</span><span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="n">pie_income</span> <span class="o">*</span> <span class="n">pir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="payroll-deductions-kiwisaver-student-loans">Payroll Deductions (KiwiSaver, Student Loans)</h3>


<div class="doc doc-object doc-module">



<h2 id="src.payroll_deductions" class="doc doc-heading">
            <code>src.payroll_deductions</code>


</h2>

    <div class="doc doc-contents first">

        <p>Helper functions for payroll deductions.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.payroll_deductions.calculate_kiwisaver_contribution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_kiwisaver_contribution</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the employee's KiwiSaver contribution.</p>
<p>KiwiSaver is a voluntary savings scheme to help New Zealanders save for
their retirement. This function calculates the employee's contribution
based on their income and a specified contribution rate.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual income subject to KiwiSaver contributions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The contribution rate, expressed as a decimal (e.g., 0.03 for 3%).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated KiwiSaver contribution. Returns 0.0 for negative or</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>zero income or rate.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/payroll_deductions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_kiwisaver_contribution</span><span class="p">(</span><span class="n">income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the employee&#39;s KiwiSaver contribution.</span>

<span class="sd">    KiwiSaver is a voluntary savings scheme to help New Zealanders save for</span>
<span class="sd">    their retirement. This function calculates the employee&#39;s contribution</span>
<span class="sd">    based on their income and a specified contribution rate.</span>

<span class="sd">    Args:</span>
<span class="sd">        income: The annual income subject to KiwiSaver contributions.</span>
<span class="sd">        rate: The contribution rate, expressed as a decimal (e.g., 0.03 for 3%).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated KiwiSaver contribution. Returns 0.0 for negative or</span>
<span class="sd">        zero income or rate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">income</span> <span class="o">*</span> <span class="n">rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.payroll_deductions.calculate_student_loan_repayment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_student_loan_repayment</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="n">repayment_threshold</span><span class="p">,</span> <span class="n">repayment_rate</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the mandatory student loan repayment for a given income.</p>
<p>This function calculates the amount of student loan repayment required
based on an individual's income. Repayments are only required if the
income is above a certain threshold.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual taxable income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>repayment_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The income threshold above which repayments apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>repayment_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rate applied to income above the threshold,
expressed as a decimal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated student loan repayment amount.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/payroll_deductions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_student_loan_repayment</span><span class="p">(</span><span class="n">income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">repayment_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">repayment_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the mandatory student loan repayment for a given income.</span>

<span class="sd">    This function calculates the amount of student loan repayment required</span>
<span class="sd">    based on an individual&#39;s income. Repayments are only required if the</span>
<span class="sd">    income is above a certain threshold.</span>

<span class="sd">    Args:</span>
<span class="sd">        income: The annual taxable income.</span>
<span class="sd">        repayment_threshold: The income threshold above which repayments apply.</span>
<span class="sd">        repayment_rate: The rate applied to income above the threshold,</span>
<span class="sd">            expressed as a decimal.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The calculated student loan repayment amount.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="n">repayment_threshold</span> <span class="ow">or</span> <span class="n">repayment_rate</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">repayment_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">repayment_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="benefit-calculations">Benefit Calculations</h2>
<h3 id="benefit-rule-classes">Benefit Rule Classes</h3>


<div class="doc doc-object doc-module">



<h2 id="src.benefit_rules" class="doc doc-heading">
            <code>src.benefit_rules</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.AccommodationSupplementRule" class="doc doc-heading">
            <code>AccommodationSupplementRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate the Accommodation Supplement.</p>
<p>The Accommodation Supplement is a weekly payment that helps people with
their rent, board, or mortgage payments.</p>
<p>This rule calculates the Accommodation Supplement entitlement based on
household income, housing costs, region, and number of dependent children.</p>
<p>The calculation is performed by the <code>calculate_accommodation_supplement</code>
function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AccommodationSupplementRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate the Accommodation Supplement.</span>

<span class="sd">    The Accommodation Supplement is a weekly payment that helps people with</span>
<span class="sd">    their rent, board, or mortgage payments.</span>

<span class="sd">    This rule calculates the Accommodation Supplement entitlement based on</span>
<span class="sd">    household income, housing costs, region, and number of dependent children.</span>

<span class="sd">    The calculation is performed by the `calculate_accommodation_supplement`</span>
<span class="sd">    function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AccommodationSupplementRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">as_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AccommodationSupplementParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate Accommodation Supplement entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">as_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">accommodation_supplement</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">as_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;accommodation_supplement_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_accommodation_supplement</span><span class="p">(</span>
                <span class="n">household_income</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;household_size&quot;</span><span class="p">]),</span>
                <span class="n">housing_costs</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;housing_costs&quot;</span><span class="p">],</span>
                <span class="n">region</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span>
                <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
                <span class="n">as_params</span><span class="o">=</span><span class="n">as_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.AccommodationSupplementRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate Accommodation Supplement entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Accommodation Supplement entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">as_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">accommodation_supplement</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;accommodation_supplement_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_accommodation_supplement</span><span class="p">(</span>
            <span class="n">household_income</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;household_size&quot;</span><span class="p">]),</span>
            <span class="n">housing_costs</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;housing_costs&quot;</span><span class="p">],</span>
            <span class="n">region</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">],</span>
            <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
            <span class="n">as_params</span><span class="o">=</span><span class="n">as_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.BSTCRule" class="doc doc-heading">
            <code>BSTCRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate the Best Start Tax Credit (BSTC).</p>
<p>The BSTC is a payment for families with a new baby. It is designed to
help with the costs of raising a child in their first few years.</p>
<p>This rule calculates the BSTC entitlement based on family income and the
age of the youngest child.</p>
<p>The calculation is performed by the <code>calculate_bstc</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BSTCRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate the Best Start Tax Credit (BSTC).</span>

<span class="sd">    The BSTC is a payment for families with a new baby. It is designed to</span>
<span class="sd">    help with the costs of raising a child in their first few years.</span>

<span class="sd">    This rule calculates the BSTC entitlement based on family income and the</span>
<span class="sd">    age of the youngest child.</span>

<span class="sd">    The calculation is performed by the `calculate_bstc` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BSTCRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bstc_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BSTCParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate BSTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">bstc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">bstc</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bstc_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
        <span class="c1"># Assume the first child&#39;s age is the relevant one for this calculation</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;bstc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_bstc</span><span class="p">(</span>
                <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
                <span class="n">child_age</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ages_of_children&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ages_of_children&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ages_of_children&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">else</span> <span class="mi">99</span><span class="p">,</span>
                <span class="n">bstc_params</span><span class="o">=</span><span class="n">bstc_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.BSTCRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate BSTC entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate BSTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">bstc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">bstc</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">bstc_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
    <span class="c1"># Assume the first child&#39;s age is the relevant one for this calculation</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;bstc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_bstc</span><span class="p">(</span>
            <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
            <span class="n">child_age</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ages_of_children&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ages_of_children&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;ages_of_children&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="mi">99</span><span class="p">,</span>
            <span class="n">bstc_params</span><span class="o">=</span><span class="n">bstc_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.DisabilityAllowanceRule" class="doc doc-heading">
            <code>DisabilityAllowanceRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate the Disability Allowance.</p>
<p>The Disability Allowance is a weekly payment for people who have regular,
ongoing costs because of a disability.</p>
<p>This rule calculates the Disability Allowance entitlement based on income,
disability-related costs, and family situation.</p>
<p>The calculation is performed by the <code>calculate_disability_allowance</code>
function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DisabilityAllowanceRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate the Disability Allowance.</span>

<span class="sd">    The Disability Allowance is a weekly payment for people who have regular,</span>
<span class="sd">    ongoing costs because of a disability.</span>

<span class="sd">    This rule calculates the Disability Allowance entitlement based on income,</span>
<span class="sd">    disability-related costs, and family situation.</span>

<span class="sd">    The calculation is performed by the `calculate_disability_allowance`</span>
<span class="sd">    function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DisabilityAllowanceRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">disability_allowance_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DisabilityAllowanceParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate Disability Allowance entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">disability_allowance_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">disability_allowance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">disability_allowance_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;disability_allowance_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_disability_allowance</span><span class="p">(</span>
                <span class="n">weekly_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
                <span class="n">disability_costs</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disability_costs&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">family_situation</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;family_household_type&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="o">=</span><span class="n">disability_allowance_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.DisabilityAllowanceRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate Disability Allowance entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Disability Allowance entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">disability_allowance_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">disability_allowance</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">disability_allowance_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;disability_allowance_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_disability_allowance</span><span class="p">(</span>
            <span class="n">weekly_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
            <span class="n">disability_costs</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disability_costs&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">family_situation</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;family_household_type&quot;</span><span class="p">],</span>
            <span class="n">params</span><span class="o">=</span><span class="n">disability_allowance_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.FTCRule" class="doc doc-heading">
            <code>FTCRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate the Family Tax Credit (FTC).</p>
<p>The FTC is a payment for families with dependent children. It is designed
to help with the costs of raising a family.</p>
<p>This rule calculates the FTC entitlement based on family income and the
number of children.</p>
<p>The calculation is performed by the <code>calculate_ftc</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FTCRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate the Family Tax Credit (FTC).</span>

<span class="sd">    The FTC is a payment for families with dependent children. It is designed</span>
<span class="sd">    to help with the costs of raising a family.</span>

<span class="sd">    This rule calculates the FTC entitlement based on family income and the</span>
<span class="sd">    number of children.</span>

<span class="sd">    The calculation is performed by the `calculate_ftc` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;FTCRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">ftc_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">FTCParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate FTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">ftc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ftc</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ftc_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ftc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_ftc</span><span class="p">(</span>
                <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
                <span class="n">num_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
                <span class="n">ftc_params</span><span class="o">=</span><span class="n">ftc_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.FTCRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate FTC entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate FTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">ftc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ftc</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ftc_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ftc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_ftc</span><span class="p">(</span>
            <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
            <span class="n">num_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
            <span class="n">ftc_params</span><span class="o">=</span><span class="n">ftc_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.IWTCRule" class="doc doc-heading">
            <code>IWTCRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate the In-Work Tax Credit (IWTC).</p>
<p>The IWTC is a payment for working families with dependent children. It is
designed to help make work pay for low to middle-income families.</p>
<p>This rule calculates the IWTC entitlement based on family income, number
of children, and hours worked.</p>
<p>The calculation is performed by the <code>calculate_iwtc</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IWTCRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate the In-Work Tax Credit (IWTC).</span>

<span class="sd">    The IWTC is a payment for working families with dependent children. It is</span>
<span class="sd">    designed to help make work pay for low to middle-income families.</span>

<span class="sd">    This rule calculates the IWTC entitlement based on family income, number</span>
<span class="sd">    of children, and hours worked.</span>

<span class="sd">    The calculation is performed by the `calculate_iwtc` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;IWTCRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">iwtc_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IWTCParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate IWTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">iwtc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iwtc</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iwtc_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;iwtc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_iwtc</span><span class="p">(</span>
                <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
                <span class="n">num_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
                <span class="n">hours_worked</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;hours_worked&quot;</span><span class="p">],</span>
                <span class="n">iwtc_params</span><span class="o">=</span><span class="n">iwtc_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.IWTCRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate IWTC entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate IWTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">iwtc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iwtc</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">iwtc_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;iwtc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_iwtc</span><span class="p">(</span>
            <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
            <span class="n">num_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
            <span class="n">hours_worked</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;hours_worked&quot;</span><span class="p">],</span>
            <span class="n">iwtc_params</span><span class="o">=</span><span class="n">iwtc_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.JSSRule" class="doc doc-heading">
            <code>JSSRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate Jobseeker Support (JSS).</p>
<p>JSS is a weekly payment for people who are not in full-time employment,
are available for and looking for work, or are unable to work due to a
health condition, injury, or disability.</p>
<p>This rule calculates the JSS entitlement based on an individual's income,
marital status, and number of dependent children.</p>
<p>The calculation is performed by the <code>calculate_jss</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">JSSRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate Jobseeker Support (JSS).</span>

<span class="sd">    JSS is a weekly payment for people who are not in full-time employment,</span>
<span class="sd">    are available for and looking for work, or are unable to work due to a</span>
<span class="sd">    health condition, injury, or disability.</span>

<span class="sd">    This rule calculates the JSS entitlement based on an individual&#39;s income,</span>
<span class="sd">    marital status, and number of dependent children.</span>

<span class="sd">    The calculation is performed by the `calculate_jss` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;JSSRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">jss_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">JSSParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate JSS entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">jss_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">jss</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">jss_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;jss_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_jss</span><span class="p">(</span>
                <span class="n">individual_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
                <span class="n">is_single</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">,</span>
                <span class="n">is_partnered</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Married&quot;</span><span class="p">,</span>
                <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
                <span class="n">jss_params</span><span class="o">=</span><span class="n">jss_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.JSSRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate JSS entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate JSS entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">jss_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">jss</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">jss_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;jss_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_jss</span><span class="p">(</span>
            <span class="n">individual_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
            <span class="n">is_single</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">,</span>
            <span class="n">is_partnered</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Married&quot;</span><span class="p">,</span>
            <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
            <span class="n">jss_params</span><span class="o">=</span><span class="n">jss_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.MFTCRule" class="doc doc-heading">
            <code>MFTCRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate the Minimum Family Tax Credit (MFTC).</p>
<p>The MFTC is a payment for working families who would otherwise be better
off on a benefit. It tops up their after-tax income to a guaranteed
minimum amount.</p>
<p>This rule calculates the MFTC entitlement based on family income and tax
paid.</p>
<p>The calculation is performed by the <code>calculate_mftc</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MFTCRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate the Minimum Family Tax Credit (MFTC).</span>

<span class="sd">    The MFTC is a payment for working families who would otherwise be better</span>
<span class="sd">    off on a benefit. It tops up their after-tax income to a guaranteed</span>
<span class="sd">    minimum amount.</span>

<span class="sd">    This rule calculates the MFTC entitlement based on family income and tax</span>
<span class="sd">    paid.</span>

<span class="sd">    The calculation is performed by the `calculate_mftc` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;MFTCRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">mftc_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MFTCParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate MFTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">mftc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mftc</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mftc_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;mftc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_mftc</span><span class="p">(</span>
                <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
                <span class="n">tax_paid</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;tax_liability&quot;</span><span class="p">],</span>
                <span class="n">mftc_params</span><span class="o">=</span><span class="n">mftc_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.MFTCRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate MFTC entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate MFTC entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">mftc_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mftc</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mftc_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;mftc_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_mftc</span><span class="p">(</span>
            <span class="n">family_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;familyinc&quot;</span><span class="p">],</span>
            <span class="n">tax_paid</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;tax_liability&quot;</span><span class="p">],</span>
            <span class="n">mftc_params</span><span class="o">=</span><span class="n">mftc_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.SLPRule" class="doc doc-heading">
            <code>SLPRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate Supported Living Payment (SLP).</p>
<p>SLP is a weekly payment for people who have, or are caring for someone
with, a significant health condition, injury, or disability.</p>
<p>This rule calculates the SLP entitlement based on an individual's income,
marital status, and disability status.</p>
<p>The calculation is performed by the <code>calculate_slp</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SLPRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate Supported Living Payment (SLP).</span>

<span class="sd">    SLP is a weekly payment for people who have, or are caring for someone</span>
<span class="sd">    with, a significant health condition, injury, or disability.</span>

<span class="sd">    This rule calculates the SLP entitlement based on an individual&#39;s income,</span>
<span class="sd">    marital status, and disability status.</span>

<span class="sd">    The calculation is performed by the `calculate_slp` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;SLPRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">slp_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SLPParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SLP entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">slp_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">slp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">slp_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;slp_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_slp</span><span class="p">(</span>
                <span class="n">individual_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
                <span class="n">is_single</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">,</span>
                <span class="n">is_partnered</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Married&quot;</span><span class="p">,</span>
                <span class="n">is_disabled</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;disability_status&quot;</span><span class="p">],</span>
                <span class="n">slp_params</span><span class="o">=</span><span class="n">slp_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.SLPRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate SLP entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate SLP entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">slp_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">slp</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">slp_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;slp_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_slp</span><span class="p">(</span>
            <span class="n">individual_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
            <span class="n">is_single</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">,</span>
            <span class="n">is_partnered</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Married&quot;</span><span class="p">,</span>
            <span class="n">is_disabled</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;disability_status&quot;</span><span class="p">],</span>
            <span class="n">slp_params</span><span class="o">=</span><span class="n">slp_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.SPSRule" class="doc doc-heading">
            <code>SPSRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate Sole Parent Support (SPS).</p>
<p>SPS is a weekly payment for single parents with dependent children.</p>
<p>This rule calculates the SPS entitlement based on an individual's income
and the number of dependent children.</p>
<p>The calculation is performed by the <code>calculate_sps</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SPSRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate Sole Parent Support (SPS).</span>

<span class="sd">    SPS is a weekly payment for single parents with dependent children.</span>

<span class="sd">    This rule calculates the SPS entitlement based on an individual&#39;s income</span>
<span class="sd">    and the number of dependent children.</span>

<span class="sd">    The calculation is performed by the `calculate_sps` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;SPSRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">sps_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">SPSParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SPS entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">sps_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sps</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sps_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;sps_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_sps</span><span class="p">(</span>
                <span class="n">individual_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
                <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
                <span class="n">sps_params</span><span class="o">=</span><span class="n">sps_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.SPSRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate SPS entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate SPS entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">sps_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sps</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sps_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">][</span><span class="s2">&quot;sps_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_sps</span><span class="p">(</span>
            <span class="n">individual_income</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_individual_income_weekly&quot;</span><span class="p">],</span>
            <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
            <span class="n">sps_params</span><span class="o">=</span><span class="n">sps_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="src.benefit_rules.WEPRule" class="doc doc-heading">
            <code>WEPRule</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.rule_registry.Rule">Rule</span></code></p>


        <p>A rule to calculate the Winter Energy Payment (WEP).</p>
<p>The WEP is a payment to help with the cost of heating during the winter
months. It is available to people receiving certain benefits or
superannuation.</p>
<p>This rule calculates the WEP entitlement based on eligibility, marital
status, and number of dependent children.</p>
<p>The calculation is performed by the <code>calculate_wep</code> function.</p>







              <details class="quote">
                <summary>Source code in <code>src/benefit_rules.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@register_rule</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WEPRule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A rule to calculate the Winter Energy Payment (WEP).</span>

<span class="sd">    The WEP is a payment to help with the cost of heating during the winter</span>
<span class="sd">    months. It is available to people receiving certain benefits or</span>
<span class="sd">    superannuation.</span>

<span class="sd">    This rule calculates the WEP entitlement based on eligibility, marital</span>
<span class="sd">    status, and number of dependent children.</span>

<span class="sd">    The calculation is performed by the `calculate_wep` function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;WEPRule&quot;</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">wep_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">WEPParams</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate WEP entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
        <span class="n">wep_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">wep</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wep_params</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;wep_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_wep</span><span class="p">(</span>
                <span class="n">is_eligible</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_jss_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_sps_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_slp_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_nz_super_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="n">is_single</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">,</span>
                <span class="n">is_partnered</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Married&quot;</span><span class="p">,</span>
                <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
                <span class="n">wep_params</span><span class="o">=</span><span class="n">wep_params</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="src.benefit_rules.WEPRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate WEP entitlement and add it to the DataFrame.</p>


            <details class="quote">
              <summary>Source code in <code>src/benefit_rules.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate WEP entitlement and add it to the DataFrame.&quot;&quot;&quot;</span>
    <span class="n">wep_params</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">wep</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">wep_params</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;wep_entitlement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_wep</span><span class="p">(</span>
            <span class="n">is_eligible</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_jss_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_sps_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_slp_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_nz_super_recipient&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">is_single</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Single&quot;</span><span class="p">,</span>
            <span class="n">is_partnered</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;marital_status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Married&quot;</span><span class="p">,</span>
            <span class="n">num_dependent_children</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;num_children&quot;</span><span class="p">],</span>
            <span class="n">wep_params</span><span class="o">=</span><span class="n">wep_params</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="benefit-calculation-functions">Benefit Calculation Functions</h3>


<div class="doc doc-object doc-module">



<h2 id="src.benefits" class="doc doc-heading">
            <code>src.benefits</code>


</h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_accommodation_supplement" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_accommodation_supplement</span><span class="p">(</span><span class="n">household_income</span><span class="p">,</span> <span class="n">housing_costs</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">num_dependent_children</span><span class="p">,</span> <span class="n">as_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Accommodation Supplement entitlement.</p>
<p>The Accommodation Supplement is a weekly payment that helps people with
their rent, board, or mortgage payments. The entitlement is based on
household income, housing costs, region, and the number of dependent
children.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>household_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total weekly income of the household.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>housing_costs</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly housing costs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>region</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The region where the household is located.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_dependent_children</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of dependent children in the
household.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.AccommodationSupplementParams">AccommodationSupplementParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the Accommodation Supplement.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly Accommodation Supplement entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_accommodation_supplement</span><span class="p">(</span>
    <span class="n">household_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">housing_costs</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">region</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">num_dependent_children</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">as_params</span><span class="p">:</span> <span class="n">AccommodationSupplementParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Accommodation Supplement entitlement.</span>

<span class="sd">    The Accommodation Supplement is a weekly payment that helps people with</span>
<span class="sd">    their rent, board, or mortgage payments. The entitlement is based on</span>
<span class="sd">    household income, housing costs, region, and the number of dependent</span>
<span class="sd">    children.</span>

<span class="sd">    Args:</span>
<span class="sd">        household_income: The total weekly income of the household.</span>
<span class="sd">        housing_costs: The weekly housing costs.</span>
<span class="sd">        region: The region where the household is located.</span>
<span class="sd">        num_dependent_children: The number of dependent children in the</span>
<span class="sd">            household.</span>
<span class="sd">        as_params: The parameters for the Accommodation Supplement.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weekly Accommodation Supplement entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">family_type</span> <span class="o">=</span> <span class="s2">&quot;single_no_children&quot;</span>
    <span class="k">if</span> <span class="n">num_dependent_children</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">family_type</span> <span class="o">=</span> <span class="s2">&quot;with_children&quot;</span>

    <span class="n">income_threshold</span> <span class="o">=</span> <span class="n">as_params</span><span class="o">.</span><span class="n">income_thresholds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">family_type</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">max_entitlement</span> <span class="o">=</span> <span class="n">as_params</span><span class="o">.</span><span class="n">max_entitlement_rates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">family_type</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="n">initial_entitlement</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="n">housing_costs</span> <span class="o">-</span> <span class="n">as_params</span><span class="o">.</span><span class="n">housing_cost_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">as_params</span><span class="o">.</span><span class="n">housing_cost_contribution_rate</span>
    <span class="p">)</span>
    <span class="n">initial_entitlement</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">initial_entitlement</span><span class="p">,</span> <span class="n">max_entitlement</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">household_income</span> <span class="o">&gt;</span> <span class="n">income_threshold</span><span class="p">:</span>
        <span class="n">abatement</span> <span class="o">=</span> <span class="p">(</span><span class="n">household_income</span> <span class="o">-</span> <span class="n">income_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">as_params</span><span class="o">.</span><span class="n">abatement_rate</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">initial_entitlement</span> <span class="o">-</span> <span class="n">abatement</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">initial_entitlement</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_bstc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_bstc</span><span class="p">(</span><span class="n">family_income</span><span class="p">,</span> <span class="n">child_age</span><span class="p">,</span> <span class="n">bstc_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Best Start Tax Credit (BSTC) entitlement.</p>
<p>The BSTC is a payment for families with a new baby. It is designed to
help with the costs of raising a child in their first few years. The
entitlement is based on family income and the age of the youngest child.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>family_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total annual family income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>child_age</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The age of the youngest child in years.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bstc_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.BSTCParams">BSTCParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the BSTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual BSTC entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_bstc</span><span class="p">(</span>
    <span class="n">family_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">child_age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">bstc_params</span><span class="p">:</span> <span class="n">BSTCParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Best Start Tax Credit (BSTC) entitlement.</span>

<span class="sd">    The BSTC is a payment for families with a new baby. It is designed to</span>
<span class="sd">    help with the costs of raising a child in their first few years. The</span>
<span class="sd">    entitlement is based on family income and the age of the youngest child.</span>

<span class="sd">    Args:</span>
<span class="sd">        family_income: The total annual family income.</span>
<span class="sd">        child_age: The age of the youngest child in years.</span>
<span class="sd">        bstc_params: The parameters for the BSTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The annual BSTC entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">child_age</span> <span class="o">&gt;</span> <span class="n">bstc_params</span><span class="o">.</span><span class="n">max_age</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">base_rate</span> <span class="o">=</span> <span class="n">bstc_params</span><span class="o">.</span><span class="n">amount</span>

    <span class="k">if</span> <span class="n">child_age</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_apply_abatement</span><span class="p">(</span>
            <span class="n">base_rate</span><span class="p">,</span>
            <span class="n">family_income</span><span class="p">,</span>
            <span class="n">bstc_params</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span>
            <span class="n">bstc_params</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">base_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_child_support" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_child_support</span><span class="p">(</span><span class="n">liable_income</span><span class="p">,</span> <span class="n">cs_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate child support payments based on liable income.</p>
<p>.. warning::
    This is a simplified implementation and does not reflect the full
    complexity of the official formula, which includes the other parent's
    income, care arrangements, and other factors.</p>
<p>Child support is a payment made by a parent who does not live with their
child to the parent or caregiver who does. This function calculates the
amount of child support payable based on the liable parent's income.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>liable_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The liable parent's annual income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cs_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.ChildSupportParams">ChildSupportParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for child support.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of child support payable.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_child_support</span><span class="p">(</span><span class="n">liable_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cs_params</span><span class="p">:</span> <span class="n">ChildSupportParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate child support payments based on liable income.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This is a simplified implementation and does not reflect the full</span>
<span class="sd">        complexity of the official formula, which includes the other parent&#39;s</span>
<span class="sd">        income, care arrangements, and other factors.</span>

<span class="sd">    Child support is a payment made by a parent who does not live with their</span>
<span class="sd">    child to the parent or caregiver who does. This function calculates the</span>
<span class="sd">    amount of child support payable based on the liable parent&#39;s income.</span>

<span class="sd">    Args:</span>
<span class="sd">        liable_income: The liable parent&#39;s annual income.</span>
<span class="sd">        cs_params: The parameters for child support.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The amount of child support payable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cs_params</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">child_support_income</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">liable_income</span> <span class="o">-</span> <span class="n">cs_params</span><span class="o">.</span><span class="n">living_allowance</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">child_support_income</span> <span class="o">*</span> <span class="n">cs_params</span><span class="o">.</span><span class="n">support_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_disability_allowance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_disability_allowance</span><span class="p">(</span><span class="n">weekly_income</span><span class="p">,</span> <span class="n">disability_costs</span><span class="p">,</span> <span class="n">family_situation</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Disability Allowance entitlement.</p>
<p>The Disability Allowance is a weekly payment for people who have regular,
ongoing costs because of a disability.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>weekly_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's or couple's weekly income before tax.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>disability_costs</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly costs due to disability.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>family_situation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The family situation of the person, which determines
the income threshold.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="src.parameters.DisabilityAllowanceParams">DisabilityAllowanceParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the Disability Allowance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly Disability Allowance entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_disability_allowance</span><span class="p">(</span>
    <span class="n">weekly_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">disability_costs</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">family_situation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">DisabilityAllowanceParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Disability Allowance entitlement.</span>

<span class="sd">    The Disability Allowance is a weekly payment for people who have regular,</span>
<span class="sd">    ongoing costs because of a disability.</span>

<span class="sd">    Args:</span>
<span class="sd">        weekly_income: The individual&#39;s or couple&#39;s weekly income before tax.</span>
<span class="sd">        disability_costs: The weekly costs due to disability.</span>
<span class="sd">        family_situation: The family situation of the person, which determines</span>
<span class="sd">            the income threshold.</span>
<span class="sd">        params: The parameters for the Disability Allowance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weekly Disability Allowance entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">income_threshold</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">income_thresholds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">family_situation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">income_threshold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">weekly_income</span> <span class="o">&gt;</span> <span class="n">income_threshold</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">disability_costs</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">max_payment</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_ftc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_ftc</span><span class="p">(</span><span class="n">family_income</span><span class="p">,</span> <span class="n">num_children</span><span class="p">,</span> <span class="n">ftc_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Family Tax Credit (FTC) entitlement.</p>
<p>The FTC is a payment for families with dependent children. It is designed
to help with the costs of raising a family. The entitlement is based on
family income and the number of children.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>family_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total annual family income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_children</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of dependent children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ftc_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.FTCParams">FTCParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the FTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual FTC entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_ftc</span><span class="p">(</span>
    <span class="n">family_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">num_children</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">ftc_params</span><span class="p">:</span> <span class="n">FTCParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Family Tax Credit (FTC) entitlement.</span>

<span class="sd">    The FTC is a payment for families with dependent children. It is designed</span>
<span class="sd">    to help with the costs of raising a family. The entitlement is based on</span>
<span class="sd">    family income and the number of children.</span>

<span class="sd">    Args:</span>
<span class="sd">        family_income: The total annual family income.</span>
<span class="sd">        num_children: The number of dependent children.</span>
<span class="sd">        ftc_params: The parameters for the FTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The annual FTC entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_children</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">base_rate</span> <span class="o">=</span> <span class="n">ftc_params</span><span class="o">.</span><span class="n">base_rate</span>
    <span class="n">base_rate</span> <span class="o">+=</span> <span class="p">(</span><span class="n">num_children</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ftc_params</span><span class="o">.</span><span class="n">child_rate</span>

    <span class="k">return</span> <span class="n">_apply_abatement</span><span class="p">(</span>
        <span class="n">base_rate</span><span class="p">,</span>
        <span class="n">family_income</span><span class="p">,</span>
        <span class="n">ftc_params</span><span class="o">.</span><span class="n">income_threshold</span><span class="p">,</span>
        <span class="n">ftc_params</span><span class="o">.</span><span class="n">abatement_rate</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_iwtc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_iwtc</span><span class="p">(</span><span class="n">family_income</span><span class="p">,</span> <span class="n">num_children</span><span class="p">,</span> <span class="n">hours_worked</span><span class="p">,</span> <span class="n">iwtc_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the In-Work Tax Credit (IWTC) entitlement.</p>
<p>The IWTC is a payment for working families with dependent children. It is
designed to help make work pay for low to middle-income families. The
entitlement is based on family income, the number of children, and the
hours worked.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>family_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total annual family income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_children</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of dependent children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hours_worked</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of hours worked per week.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>iwtc_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.IWTCParams">IWTCParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the IWTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual IWTC entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_iwtc</span><span class="p">(</span>
    <span class="n">family_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">num_children</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">hours_worked</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">iwtc_params</span><span class="p">:</span> <span class="n">IWTCParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the In-Work Tax Credit (IWTC) entitlement.</span>

<span class="sd">    The IWTC is a payment for working families with dependent children. It is</span>
<span class="sd">    designed to help make work pay for low to middle-income families. The</span>
<span class="sd">    entitlement is based on family income, the number of children, and the</span>
<span class="sd">    hours worked.</span>

<span class="sd">    Args:</span>
<span class="sd">        family_income: The total annual family income.</span>
<span class="sd">        num_children: The number of dependent children.</span>
<span class="sd">        hours_worked: The number of hours worked per week.</span>
<span class="sd">        iwtc_params: The parameters for the IWTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The annual IWTC entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_children</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">hours_worked</span> <span class="o">&lt;</span> <span class="n">iwtc_params</span><span class="o">.</span><span class="n">min_hours_worked</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">base_rate</span> <span class="o">=</span> <span class="n">iwtc_params</span><span class="o">.</span><span class="n">base_rate</span>
    <span class="n">base_rate</span> <span class="o">+=</span> <span class="p">(</span><span class="n">num_children</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">iwtc_params</span><span class="o">.</span><span class="n">child_rate</span>

    <span class="k">return</span> <span class="n">_apply_abatement</span><span class="p">(</span>
        <span class="n">base_rate</span><span class="p">,</span>
        <span class="n">family_income</span><span class="p">,</span>
        <span class="n">iwtc_params</span><span class="o">.</span><span class="n">income_threshold</span><span class="p">,</span>
        <span class="n">iwtc_params</span><span class="o">.</span><span class="n">abatement_rate</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_jss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_jss</span><span class="p">(</span><span class="n">individual_income</span><span class="p">,</span> <span class="n">is_single</span><span class="p">,</span> <span class="n">is_partnered</span><span class="p">,</span> <span class="n">num_dependent_children</span><span class="p">,</span> <span class="n">jss_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Jobseeker Support (JSS) entitlement.</p>
<p>JSS is a weekly payment for people who are not in full-time employment.
The entitlement is based on the individual's income, marital status, and
the number of dependent children.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>individual_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's weekly income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_single</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is single.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_partnered</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is partnered.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_dependent_children</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of dependent children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>jss_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.JSSParams">JSSParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for JSS.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly JSS entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_jss</span><span class="p">(</span>
    <span class="n">individual_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">is_single</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_partnered</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">num_dependent_children</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">jss_params</span><span class="p">:</span> <span class="n">JSSParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Jobseeker Support (JSS) entitlement.</span>

<span class="sd">    JSS is a weekly payment for people who are not in full-time employment.</span>
<span class="sd">    The entitlement is based on the individual&#39;s income, marital status, and</span>
<span class="sd">    the number of dependent children.</span>

<span class="sd">    Args:</span>
<span class="sd">        individual_income: The individual&#39;s weekly income.</span>
<span class="sd">        is_single: Whether the individual is single.</span>
<span class="sd">        is_partnered: Whether the individual is partnered.</span>
<span class="sd">        num_dependent_children: The number of dependent children.</span>
<span class="sd">        jss_params: The parameters for JSS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weekly JSS entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">is_single</span><span class="p">:</span>
        <span class="n">base_rate</span> <span class="o">=</span> <span class="n">jss_params</span><span class="o">.</span><span class="n">single_rate</span>
    <span class="k">elif</span> <span class="n">is_partnered</span><span class="p">:</span>
        <span class="n">base_rate</span> <span class="o">=</span> <span class="n">jss_params</span><span class="o">.</span><span class="n">couple_rate</span>
    <span class="n">base_rate</span> <span class="o">+=</span> <span class="n">num_dependent_children</span> <span class="o">*</span> <span class="n">jss_params</span><span class="o">.</span><span class="n">child_rate</span>

    <span class="k">if</span> <span class="n">individual_income</span> <span class="o">&gt;</span> <span class="n">jss_params</span><span class="o">.</span><span class="n">income_abatement_threshold</span><span class="p">:</span>
        <span class="n">abatement</span> <span class="o">=</span> <span class="p">(</span><span class="n">individual_income</span> <span class="o">-</span> <span class="n">jss_params</span><span class="o">.</span><span class="n">income_abatement_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">jss_params</span><span class="o">.</span><span class="n">abatement_rate</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">base_rate</span> <span class="o">-</span> <span class="n">abatement</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">base_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_mftc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_mftc</span><span class="p">(</span><span class="n">family_income</span><span class="p">,</span> <span class="n">tax_paid</span><span class="p">,</span> <span class="n">mftc_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Minimum Family Tax Credit (MFTC) entitlement.</p>
<p>The MFTC is a payment for working families who would otherwise be better
off on a benefit. It tops up their after-tax income to a guaranteed
minimum amount.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>family_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total annual family income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tax_paid</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of tax paid by the family.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mftc_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.MFTCParams">MFTCParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the MFTC.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The annual MFTC entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_mftc</span><span class="p">(</span>
    <span class="n">family_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tax_paid</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mftc_params</span><span class="p">:</span> <span class="n">MFTCParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Minimum Family Tax Credit (MFTC) entitlement.</span>

<span class="sd">    The MFTC is a payment for working families who would otherwise be better</span>
<span class="sd">    off on a benefit. It tops up their after-tax income to a guaranteed</span>
<span class="sd">    minimum amount.</span>

<span class="sd">    Args:</span>
<span class="sd">        family_income: The total annual family income.</span>
<span class="sd">        tax_paid: The amount of tax paid by the family.</span>
<span class="sd">        mftc_params: The parameters for the MFTC.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The annual MFTC entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">guaranteed_income</span> <span class="o">=</span> <span class="n">mftc_params</span><span class="o">.</span><span class="n">guaranteed_income</span>
    <span class="n">net_income</span> <span class="o">=</span> <span class="n">family_income</span> <span class="o">-</span> <span class="n">tax_paid</span>

    <span class="k">if</span> <span class="n">net_income</span> <span class="o">&gt;=</span> <span class="n">guaranteed_income</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">guaranteed_income</span> <span class="o">-</span> <span class="n">net_income</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_ppl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_ppl</span><span class="p">(</span><span class="n">weeks_taken</span><span class="p">,</span> <span class="n">ppl_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate Paid Parental Leave (PPL) payments.</p>
<p>PPL is a payment for eligible parents to help them take time off work to
care for a new baby or a child under six who has come into their care.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>weeks_taken</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of weeks of PPL taken.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ppl_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.PPLParams">PPLParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for PPL.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total PPL payment.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_ppl</span><span class="p">(</span><span class="n">weeks_taken</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ppl_params</span><span class="p">:</span> <span class="n">PPLParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Paid Parental Leave (PPL) payments.</span>

<span class="sd">    PPL is a payment for eligible parents to help them take time off work to</span>
<span class="sd">    care for a new baby or a child under six who has come into their care.</span>

<span class="sd">    Args:</span>
<span class="sd">        weeks_taken: The number of weeks of PPL taken.</span>
<span class="sd">        ppl_params: The parameters for PPL.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The total PPL payment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ppl_params</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">weeks</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">weeks_taken</span><span class="p">,</span> <span class="n">ppl_params</span><span class="o">.</span><span class="n">max_weeks</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">weeks</span> <span class="o">*</span> <span class="n">ppl_params</span><span class="o">.</span><span class="n">weekly_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_slp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_slp</span><span class="p">(</span><span class="n">individual_income</span><span class="p">,</span> <span class="n">is_single</span><span class="p">,</span> <span class="n">is_partnered</span><span class="p">,</span> <span class="n">is_disabled</span><span class="p">,</span> <span class="n">slp_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Supported Living Payment (SLP) entitlement.</p>
<p>SLP is a weekly payment for people who have, or are caring for someone
with, a significant health condition, injury, or disability. The
entitlement is based on the individual's income, marital status, and
disability status.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>individual_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's weekly income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_single</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is single.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_partnered</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is partnered.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_disabled</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual has a disability.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slp_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.SLPParams">SLPParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for SLP.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly SLP entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_slp</span><span class="p">(</span>
    <span class="n">individual_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">is_single</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_partnered</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_disabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">slp_params</span><span class="p">:</span> <span class="n">SLPParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Supported Living Payment (SLP) entitlement.</span>

<span class="sd">    SLP is a weekly payment for people who have, or are caring for someone</span>
<span class="sd">    with, a significant health condition, injury, or disability. The</span>
<span class="sd">    entitlement is based on the individual&#39;s income, marital status, and</span>
<span class="sd">    disability status.</span>

<span class="sd">    Args:</span>
<span class="sd">        individual_income: The individual&#39;s weekly income.</span>
<span class="sd">        is_single: Whether the individual is single.</span>
<span class="sd">        is_partnered: Whether the individual is partnered.</span>
<span class="sd">        is_disabled: Whether the individual has a disability.</span>
<span class="sd">        slp_params: The parameters for SLP.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weekly SLP entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_disabled</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">base_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">is_single</span><span class="p">:</span>
        <span class="n">base_rate</span> <span class="o">=</span> <span class="n">slp_params</span><span class="o">.</span><span class="n">single_rate</span>
    <span class="k">elif</span> <span class="n">is_partnered</span><span class="p">:</span>
        <span class="n">base_rate</span> <span class="o">=</span> <span class="n">slp_params</span><span class="o">.</span><span class="n">couple_rate</span>

    <span class="k">if</span> <span class="n">individual_income</span> <span class="o">&gt;</span> <span class="n">slp_params</span><span class="o">.</span><span class="n">income_abatement_threshold</span><span class="p">:</span>
        <span class="n">abatement</span> <span class="o">=</span> <span class="p">(</span><span class="n">individual_income</span> <span class="o">-</span> <span class="n">slp_params</span><span class="o">.</span><span class="n">income_abatement_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">slp_params</span><span class="o">.</span><span class="n">abatement_rate</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">base_rate</span> <span class="o">-</span> <span class="n">abatement</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">base_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_sps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_sps</span><span class="p">(</span><span class="n">individual_income</span><span class="p">,</span> <span class="n">num_dependent_children</span><span class="p">,</span> <span class="n">sps_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Sole Parent Support (SPS) entitlement.</p>
<p>SPS is a weekly payment for single parents with dependent children. The
entitlement is based on the individual's income and the number of
dependent children.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>individual_income</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The individual's weekly income.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_dependent_children</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of dependent children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sps_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.SPSParams">SPSParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for SPS.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly SPS entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_sps</span><span class="p">(</span>
    <span class="n">individual_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">num_dependent_children</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">sps_params</span><span class="p">:</span> <span class="n">SPSParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Sole Parent Support (SPS) entitlement.</span>

<span class="sd">    SPS is a weekly payment for single parents with dependent children. The</span>
<span class="sd">    entitlement is based on the individual&#39;s income and the number of</span>
<span class="sd">    dependent children.</span>

<span class="sd">    Args:</span>
<span class="sd">        individual_income: The individual&#39;s weekly income.</span>
<span class="sd">        num_dependent_children: The number of dependent children.</span>
<span class="sd">        sps_params: The parameters for SPS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weekly SPS entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_dependent_children</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">base_rate</span> <span class="o">=</span> <span class="n">sps_params</span><span class="o">.</span><span class="n">base_rate</span>
    <span class="k">if</span> <span class="n">individual_income</span> <span class="o">&gt;</span> <span class="n">sps_params</span><span class="o">.</span><span class="n">income_abatement_threshold</span><span class="p">:</span>
        <span class="n">abatement</span> <span class="o">=</span> <span class="p">(</span><span class="n">individual_income</span> <span class="o">-</span> <span class="n">sps_params</span><span class="o">.</span><span class="n">income_abatement_threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">sps_params</span><span class="o">.</span><span class="n">abatement_rate</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">base_rate</span> <span class="o">-</span> <span class="n">abatement</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">base_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.benefits.calculate_wep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_wep</span><span class="p">(</span><span class="n">is_eligible</span><span class="p">,</span> <span class="n">is_single</span><span class="p">,</span> <span class="n">is_partnered</span><span class="p">,</span> <span class="n">num_dependent_children</span><span class="p">,</span> <span class="n">wep_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the Winter Energy Payment (WEP) entitlement.</p>
<p>The WEP is a payment to help with the cost of heating during the winter
months. It is available to people receiving certain benefits or
superannuation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_eligible</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is eligible for the WEP.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_single</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is single.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_partnered</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the individual is partnered.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_dependent_children</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of dependent children.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wep_params</code>
            </td>
            <td>
                  <code><span title="src.parameters.WEPParams">WEPParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters for the WEP.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weekly WEP entitlement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/benefits.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_wep</span><span class="p">(</span>
    <span class="n">is_eligible</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_single</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">is_partnered</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">num_dependent_children</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">wep_params</span><span class="p">:</span> <span class="n">WEPParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Winter Energy Payment (WEP) entitlement.</span>

<span class="sd">    The WEP is a payment to help with the cost of heating during the winter</span>
<span class="sd">    months. It is available to people receiving certain benefits or</span>
<span class="sd">    superannuation.</span>

<span class="sd">    Args:</span>
<span class="sd">        is_eligible: Whether the individual is eligible for the WEP.</span>
<span class="sd">        is_single: Whether the individual is single.</span>
<span class="sd">        is_partnered: Whether the individual is partnered.</span>
<span class="sd">        num_dependent_children: The number of dependent children.</span>
<span class="sd">        wep_params: The parameters for the WEP.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The weekly WEP entitlement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_eligible</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="n">base_rate</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">is_single</span><span class="p">:</span>
        <span class="n">base_rate</span> <span class="o">=</span> <span class="n">wep_params</span><span class="o">.</span><span class="n">single_rate</span>
    <span class="k">elif</span> <span class="n">is_partnered</span><span class="p">:</span>
        <span class="n">base_rate</span> <span class="o">=</span> <span class="n">wep_params</span><span class="o">.</span><span class="n">couple_rate</span>
    <span class="n">base_rate</span> <span class="o">+=</span> <span class="n">num_dependent_children</span> <span class="o">*</span> <span class="n">wep_params</span><span class="o">.</span><span class="n">child_rate</span>

    <span class="k">return</span> <span class="n">base_rate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>